!function(t){var e={};function r(o){if(e[o])return e[o].exports;var s=e[o]={i:o,l:!1,exports:{}};return t[o].call(s.exports,s,s.exports,r),s.l=!0,s.exports}r.m=t,r.c=e,r.d=function(t,e,o){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)r.d(o,s,function(e){return t[e]}.bind(null,s));return o},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=3)}([function(t,e,r){"use strict";const o=Object.prototype.toString;t.exports=function(t){return o.call(t).endsWith("Array]")}},function(t,e){const r=(t,e,r)=>(e[0]-t[0])*(r[1]-t[1])-(e[1]-t[1])*(r[0]-t[0]),o=t=>{const e=t[4]*t[8]-t[5]*t[7],r=t[3]*t[8]-t[5]*t[6],o=t[3]*t[7]-t[4]*t[6];return t[0]*e-t[1]*r+t[2]*o},s=(t,e)=>[t[0]-e[0],t[1]-e[1]],n=(t,e)=>{const r=t[0]*e[1]-t[1]*e[0];return.5*Math.abs(r)};t.exports={matrixInverse33:(t,e)=>{const r=o(t);if(Math.abs(r)<=e)return null;const s=1/r;return[(t[4]*t[8]-t[5]*t[7])*s,(t[2]*t[7]-t[1]*t[8])*s,(t[1]*t[5]-t[2]*t[4])*s,(t[5]*t[6]-t[3]*t[8])*s,(t[0]*t[8]-t[2]*t[6])*s,(t[2]*t[3]-t[0]*t[5])*s,(t[3]*t[7]-t[4]*t[6])*s,(t[1]*t[6]-t[0]*t[7])*s,(t[0]*t[4]-t[1]*t[3])*s]},matrixMul33:(t,e)=>{const r=[];return r[0]=t[0]*e[0]+t[1]*e[3]+t[2]*e[6],r[1]=t[0]*e[1]+t[1]*e[4]+t[2]*e[7],r[2]=t[0]*e[2]+t[1]*e[5]+t[2]*e[8],r[3]=t[3]*e[0]+t[4]*e[3]+t[5]*e[6],r[4]=t[3]*e[1]+t[4]*e[4]+t[5]*e[7],r[5]=t[3]*e[2]+t[4]*e[5]+t[5]*e[8],r[6]=t[6]*e[0]+t[7]*e[3]+t[8]*e[6],r[7]=t[6]*e[1]+t[7]*e[4]+t[8]*e[7],r[8]=t[6]*e[2]+t[7]*e[5]+t[8]*e[8],r},quadrilateralConvex:(t,e,o,s)=>{const n=r(t,e,o)<=0;return r(e,o,s)<=0===n&&(r(o,s,t)<=0===n&&r(s,t,e)<=0===n)},smallestTriangleArea:(t,e,r,o)=>{const i=s(e,t),h=s(r,t),l=s(o,t),u=s(e,r),a=s(o,r),c=n(i,h),f=n(h,l),m=n(i,l),g=n(u,a);return Math.min(Math.min(Math.min(c,f),m),g)},multiplyPointHomographyInhomogenous:(t,e)=>{const r=e[6]*t[0]+e[7]*t[1]+e[8],o=[];return o[0]=(e[0]*t[0]+e[1]*t[1]+e[2])/r,o[1]=(e[3]*t[0]+e[4]*t[1]+e[5])/r,o},checkThreePointsConsistent:(t,e,o,s,n,i)=>r(t,e,o)>0==r(s,n,i)>0,checkFourPointsConsistent:(t,e,o,s,n,i,h,l)=>r(t,e,o)>0==r(n,i,h)>0&&(r(e,o,s)>0==r(i,h,l)>0&&(r(o,s,t)>0==r(h,l,n)>0&&r(s,t,e)>0==r(l,n,i)>0)),determinant:o}},function(t,e,r){"use strict";r.r(e),r.d(e,"AbstractMatrix",(function(){return v})),r.d(e,"default",(function(){return S})),r.d(e,"Matrix",(function(){return S})),r.d(e,"MatrixColumnView",(function(){return T})),r.d(e,"MatrixColumnSelectionView",(function(){return q})),r.d(e,"MatrixFlipColumnView",(function(){return A})),r.d(e,"MatrixFlipRowView",(function(){return C})),r.d(e,"MatrixRowView",(function(){return V})),r.d(e,"MatrixRowSelectionView",(function(){return P})),r.d(e,"MatrixSelectionView",(function(){return N})),r.d(e,"MatrixSubView",(function(){return D})),r.d(e,"MatrixTransposeView",(function(){return j})),r.d(e,"wrap",(function(){return z})),r.d(e,"WrapperMatrix1D",(function(){return _})),r.d(e,"WrapperMatrix2D",(function(){return F})),r.d(e,"solve",(function(){return G})),r.d(e,"inverse",(function(){return $})),r.d(e,"determinant",(function(){return X})),r.d(e,"linearDependencies",(function(){return Q})),r.d(e,"pseudoInverse",(function(){return W})),r.d(e,"covariance",(function(){return Y})),r.d(e,"correlation",(function(){return K})),r.d(e,"SingularValueDecomposition",(function(){return L})),r.d(e,"SVD",(function(){return L})),r.d(e,"EigenvalueDecomposition",(function(){return Z})),r.d(e,"EVD",(function(){return Z})),r.d(e,"CholeskyDecomposition",(function(){return et})),r.d(e,"CHO",(function(){return et})),r.d(e,"LuDecomposition",(function(){return H})),r.d(e,"LU",(function(){return H})),r.d(e,"QrDecomposition",(function(){return U})),r.d(e,"QR",(function(){return U})),r.d(e,"Nipals",(function(){return rt})),r.d(e,"NIPALS",(function(){return rt}));var o=r(0),s=r.n(o);var n=function(t){if(!s()(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");for(var e=t[0],r=1;r<t.length;r++)t[r]>e&&(e=t[r]);return e};var i=function(t){if(!s()(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");for(var e=t[0],r=1;r<t.length;r++)t[r]<e&&(e=t[r]);return e};var h=function(t){var e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!s()(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");if(void 0!==r.output){if(!s()(r.output))throw new TypeError("output option must be an array if specified");e=r.output}else e=new Array(t.length);var o=i(t),h=n(t);if(o===h)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var l=r.min,u=void 0===l?r.autoMinMax?o:0:l,a=r.max,c=void 0===a?r.autoMinMax?h:1:a;if(u>=c)throw new RangeError("min option must be smaller than max option");for(var f=(c-u)/(h-o),m=0;m<t.length;m++)e[m]=(t[m]-o)*f+u;return e};const l=" ".repeat(2),u=" ".repeat(4);function a(t,e={}){const{maxRows:r=15,maxColumns:o=10,maxNumSize:s=8}=e;return`${t.constructor.name} {\n${l}[\n${u}${function(t,e,r,o){const{rows:s,columns:n}=t,i=Math.min(s,e),h=Math.min(n,r),l=[];for(let e=0;e<i;e++){let r=[];for(let s=0;s<h;s++)r.push(c(t.get(e,s),o));l.push(""+r.join(" "))}h!==n&&(l[l.length-1]+=` ... ${n-r} more columns`);i!==s&&l.push(`... ${s-e} more rows`);return l.join("\n"+u)}(t,r,o,s)}\n${l}]\n${l}rows: ${t.rows}\n${l}columns: ${t.columns}\n}`}function c(t,e){const r=String(t);if(r.length<=e)return r.padEnd(e," ");const o=t.toPrecision(e-2);if(o.length<=e)return o;const s=t.toExponential(e-2),n=s.indexOf("e"),i=s.slice(n);return s.slice(0,e-i.length)+i}function f(t,e,r){let o=r?t.rows:t.rows-1;if(e<0||e>o)throw new RangeError("Row index out of range")}function m(t,e,r){let o=r?t.columns:t.columns-1;if(e<0||e>o)throw new RangeError("Column index out of range")}function g(t,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==t.columns)throw new RangeError("vector size must be the same as the number of columns");return e}function w(t,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==t.rows)throw new RangeError("vector size must be the same as the number of rows");return e}function p(t,e,r){return{row:d(t,e),column:y(t,r)}}function d(t,e){if("object"!=typeof e)throw new TypeError("unexpected type for row indices");if(e.some(e=>e<0||e>=t.rows))throw new RangeError("row indices are out of range");return Array.isArray(e)||(e=Array.from(e)),e}function y(t,e){if("object"!=typeof e)throw new TypeError("unexpected type for column indices");if(e.some(e=>e<0||e>=t.columns))throw new RangeError("column indices are out of range");return Array.isArray(e)||(e=Array.from(e)),e}function x(t,e,r,o,s){if(5!==arguments.length)throw new RangeError("expected 4 arguments");if(b("startRow",e),b("endRow",r),b("startColumn",o),b("endColumn",s),e>r||o>s||e<0||e>=t.rows||r<0||r>=t.rows||o<0||o>=t.columns||s<0||s>=t.columns)throw new RangeError("Submatrix indices are out of range")}function M(t,e=0){let r=[];for(let o=0;o<t;o++)r.push(e);return r}function b(t,e){if("number"!=typeof e)throw new TypeError(t+" must be a number")}class v{static from1DArray(t,e,r){if(t*e!==r.length)throw new RangeError("data length does not match given dimensions");let o=new S(t,e);for(let s=0;s<t;s++)for(let t=0;t<e;t++)o.set(s,t,r[s*e+t]);return o}static rowVector(t){let e=new S(1,t.length);for(let r=0;r<t.length;r++)e.set(0,r,t[r]);return e}static columnVector(t){let e=new S(t.length,1);for(let r=0;r<t.length;r++)e.set(r,0,t[r]);return e}static zeros(t,e){return new S(t,e)}static ones(t,e){return new S(t,e).fill(1)}static rand(t,e,r={}){if("object"!=typeof r)throw new TypeError("options must be an object");const{random:o=Math.random}=r;let s=new S(t,e);for(let r=0;r<t;r++)for(let t=0;t<e;t++)s.set(r,t,o());return s}static randInt(t,e,r={}){if("object"!=typeof r)throw new TypeError("options must be an object");const{min:o=0,max:s=1e3,random:n=Math.random}=r;if(!Number.isInteger(o))throw new TypeError("min must be an integer");if(!Number.isInteger(s))throw new TypeError("max must be an integer");if(o>=s)throw new RangeError("min must be smaller than max");let i=s-o,h=new S(t,e);for(let r=0;r<t;r++)for(let t=0;t<e;t++){let e=o+Math.round(n()*i);h.set(r,t,e)}return h}static eye(t,e,r){void 0===e&&(e=t),void 0===r&&(r=1);let o=Math.min(t,e),s=this.zeros(t,e);for(let t=0;t<o;t++)s.set(t,t,r);return s}static diag(t,e,r){let o=t.length;void 0===e&&(e=o),void 0===r&&(r=e);let s=Math.min(o,e,r),n=this.zeros(e,r);for(let e=0;e<s;e++)n.set(e,e,t[e]);return n}static min(t,e){t=this.checkMatrix(t),e=this.checkMatrix(e);let r=t.rows,o=t.columns,s=new S(r,o);for(let n=0;n<r;n++)for(let r=0;r<o;r++)s.set(n,r,Math.min(t.get(n,r),e.get(n,r)));return s}static max(t,e){t=this.checkMatrix(t),e=this.checkMatrix(e);let r=t.rows,o=t.columns,s=new this(r,o);for(let n=0;n<r;n++)for(let r=0;r<o;r++)s.set(n,r,Math.max(t.get(n,r),e.get(n,r)));return s}static checkMatrix(t){return v.isMatrix(t)?t:new S(t)}static isMatrix(t){return null!=t&&"Matrix"===t.klass}get size(){return this.rows*this.columns}apply(t){if("function"!=typeof t)throw new TypeError("callback must be a function");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t.call(this,e,r);return this}to1DArray(){let t=[];for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t.push(this.get(e,r));return t}to2DArray(){let t=[];for(let e=0;e<this.rows;e++){t.push([]);for(let r=0;r<this.columns;r++)t[e].push(this.get(e,r))}return t}toJSON(){return this.to2DArray()}isRowVector(){return 1===this.rows}isColumnVector(){return 1===this.columns}isVector(){return 1===this.rows||1===this.columns}isSquare(){return this.rows===this.columns}isSymmetric(){if(this.isSquare()){for(let t=0;t<this.rows;t++)for(let e=0;e<=t;e++)if(this.get(t,e)!==this.get(e,t))return!1;return!0}return!1}isEchelonForm(){let t=0,e=0,r=-1,o=!0,s=!1;for(;t<this.rows&&o;){for(e=0,s=!1;e<this.columns&&!1===s;)0===this.get(t,e)?e++:1===this.get(t,e)&&e>r?(s=!0,r=e):(o=!1,s=!0);t++}return o}isReducedEchelonForm(){let t=0,e=0,r=-1,o=!0,s=!1;for(;t<this.rows&&o;){for(e=0,s=!1;e<this.columns&&!1===s;)0===this.get(t,e)?e++:1===this.get(t,e)&&e>r?(s=!0,r=e):(o=!1,s=!0);for(let r=e+1;r<this.rows;r++)0!==this.get(t,r)&&(o=!1);t++}return o}echelonForm(){let t=this.clone(),e=0,r=0;for(;e<t.rows&&r<t.columns;){let o=e;for(let s=e;s<t.rows;s++)t.get(s,r)>t.get(o,r)&&(o=s);if(0===t.get(o,r))r++;else{t.swapRows(e,o);let s=t.get(e,r);for(let o=r;o<t.columns;o++)t.set(e,o,t.get(e,o)/s);for(let o=e+1;o<t.rows;o++){let s=t.get(o,r)/t.get(e,r);t.set(o,r,0);for(let n=r+1;n<t.columns;n++)t.set(o,n,t.get(o,n)-t.get(e,n)*s)}e++,r++}}return t}reducedEchelonForm(){let t=this.echelonForm(),e=t.columns,r=t.rows,o=r-1;for(;o>=0;)if(0===t.maxRow(o))o--;else{let s=0,n=!1;for(;s<r&&!1===n;)1===t.get(o,s)?n=!0:s++;for(let r=0;r<o;r++){let n=t.get(r,s);for(let i=s;i<e;i++){let e=t.get(r,i)-n*t.get(o,i);t.set(r,i,e)}}o--}return t}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(t={}){if("object"!=typeof t)throw new TypeError("options must be an object");const{rows:e=1,columns:r=1}=t;if(!Number.isInteger(e)||e<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(r)||r<=0)throw new TypeError("columns must be a positive integer");let o=new S(this.rows*e,this.columns*r);for(let t=0;t<e;t++)for(let e=0;e<r;e++)o.setSubMatrix(this,this.rows*t,this.columns*e);return o}fill(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,t);return this}neg(){return this.mulS(-1)}getRow(t){f(this,t);let e=[];for(let r=0;r<this.columns;r++)e.push(this.get(t,r));return e}getRowVector(t){return S.rowVector(this.getRow(t))}setRow(t,e){f(this,t),e=g(this,e);for(let r=0;r<this.columns;r++)this.set(t,r,e[r]);return this}swapRows(t,e){f(this,t),f(this,e);for(let r=0;r<this.columns;r++){let o=this.get(t,r);this.set(t,r,this.get(e,r)),this.set(e,r,o)}return this}getColumn(t){m(this,t);let e=[];for(let r=0;r<this.rows;r++)e.push(this.get(r,t));return e}getColumnVector(t){return S.columnVector(this.getColumn(t))}setColumn(t,e){m(this,t),e=w(this,e);for(let r=0;r<this.rows;r++)this.set(r,t,e[r]);return this}swapColumns(t,e){m(this,t),m(this,e);for(let r=0;r<this.rows;r++){let o=this.get(r,t);this.set(r,t,this.get(r,e)),this.set(r,e,o)}return this}addRowVector(t){t=g(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)+t[r]);return this}subRowVector(t){t=g(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)-t[r]);return this}mulRowVector(t){t=g(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)*t[r]);return this}divRowVector(t){t=g(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)/t[r]);return this}addColumnVector(t){t=w(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)+t[e]);return this}subColumnVector(t){t=w(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)-t[e]);return this}mulColumnVector(t){t=w(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)*t[e]);return this}divColumnVector(t){t=w(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)/t[e]);return this}mulRow(t,e){f(this,t);for(let r=0;r<this.columns;r++)this.set(t,r,this.get(t,r)*e);return this}mulColumn(t,e){m(this,t);for(let r=0;r<this.rows;r++)this.set(r,t,this.get(r,t)*e);return this}max(){let t=this.get(0,0);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.get(e,r)>t&&(t=this.get(e,r));return t}maxIndex(){let t=this.get(0,0),e=[0,0];for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.get(r,o)>t&&(t=this.get(r,o),e[0]=r,e[1]=o);return e}min(){let t=this.get(0,0);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.get(e,r)<t&&(t=this.get(e,r));return t}minIndex(){let t=this.get(0,0),e=[0,0];for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.get(r,o)<t&&(t=this.get(r,o),e[0]=r,e[1]=o);return e}maxRow(t){f(this,t);let e=this.get(t,0);for(let r=1;r<this.columns;r++)this.get(t,r)>e&&(e=this.get(t,r));return e}maxRowIndex(t){f(this,t);let e=this.get(t,0),r=[t,0];for(let o=1;o<this.columns;o++)this.get(t,o)>e&&(e=this.get(t,o),r[1]=o);return r}minRow(t){f(this,t);let e=this.get(t,0);for(let r=1;r<this.columns;r++)this.get(t,r)<e&&(e=this.get(t,r));return e}minRowIndex(t){f(this,t);let e=this.get(t,0),r=[t,0];for(let o=1;o<this.columns;o++)this.get(t,o)<e&&(e=this.get(t,o),r[1]=o);return r}maxColumn(t){m(this,t);let e=this.get(0,t);for(let r=1;r<this.rows;r++)this.get(r,t)>e&&(e=this.get(r,t));return e}maxColumnIndex(t){m(this,t);let e=this.get(0,t),r=[0,t];for(let o=1;o<this.rows;o++)this.get(o,t)>e&&(e=this.get(o,t),r[0]=o);return r}minColumn(t){m(this,t);let e=this.get(0,t);for(let r=1;r<this.rows;r++)this.get(r,t)<e&&(e=this.get(r,t));return e}minColumnIndex(t){m(this,t);let e=this.get(0,t),r=[0,t];for(let o=1;o<this.rows;o++)this.get(o,t)<e&&(e=this.get(o,t),r[0]=o);return r}diag(){let t=Math.min(this.rows,this.columns),e=[];for(let r=0;r<t;r++)e.push(this.get(r,r));return e}norm(t="frobenius"){let e=0;if("max"===t)return this.max();if("frobenius"===t){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)e+=this.get(t,r)*this.get(t,r);return Math.sqrt(e)}throw new RangeError("unknown norm type: "+t)}cumulativeSum(){let t=0;for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t+=this.get(e,r),this.set(e,r,t);return this}dot(t){v.isMatrix(t)&&(t=t.to1DArray());let e=this.to1DArray();if(e.length!==t.length)throw new RangeError("vectors do not have the same size");let r=0;for(let o=0;o<e.length;o++)r+=e[o]*t[o];return r}mmul(t){t=S.checkMatrix(t);let e=this.rows,r=this.columns,o=t.columns,s=new S(e,o),n=new Float64Array(r);for(let i=0;i<o;i++){for(let e=0;e<r;e++)n[e]=t.get(e,i);for(let t=0;t<e;t++){let e=0;for(let o=0;o<r;o++)e+=this.get(t,o)*n[o];s.set(t,i,e)}}return s}strassen2x2(t){t=S.checkMatrix(t);let e=new S(2,2);const r=this.get(0,0),o=t.get(0,0),s=this.get(0,1),n=t.get(0,1),i=this.get(1,0),h=t.get(1,0),l=this.get(1,1),u=t.get(1,1),a=(r+l)*(o+u),c=(i+l)*o,f=r*(n-u),m=l*(h-o),g=(r+s)*u,w=a+m-g+(s-l)*(h+u),p=f+g,d=c+m,y=a-c+f+(i-r)*(o+n);return e.set(0,0,w),e.set(0,1,p),e.set(1,0,d),e.set(1,1,y),e}strassen3x3(t){t=S.checkMatrix(t);let e=new S(3,3);const r=this.get(0,0),o=this.get(0,1),s=this.get(0,2),n=this.get(1,0),i=this.get(1,1),h=this.get(1,2),l=this.get(2,0),u=this.get(2,1),a=this.get(2,2),c=t.get(0,0),f=t.get(0,1),m=t.get(0,2),g=t.get(1,0),w=t.get(1,1),p=t.get(1,2),d=t.get(2,0),y=t.get(2,1),x=t.get(2,2),M=(r-n)*(-f+w),b=(-r+n+i)*(c-f+w),v=(n+i)*(-c+f),E=r*c,k=(-r+l+u)*(c-m+p),R=(-r+l)*(m-p),I=(l+u)*(-c+m),T=(-s+u+a)*(w+d-y),q=(s-a)*(w-y),A=s*d,C=(u+a)*(-d+y),V=(-s+i+h)*(p+d-x),P=(s-h)*(p-x),N=(i+h)*(-d+x),D=E+A+o*g,j=(r+o+s-n-i-u-a)*w+b+v+E+T+A+C,_=E+k+I+(r+o+s-i-h-l-u)*p+A+V+N,F=M+i*(-c+f+g-w-p-d+x)+b+E+A+V+P,z=M+b+v+E+h*y,H=A+V+P+N+n*m,O=E+k+R+u*(-c+m+g-w-p-d+y)+T+q+A,U=T+q+A+C+l*f,L=E+k+R+I+a*x;return e.set(0,0,D),e.set(0,1,j),e.set(0,2,_),e.set(1,0,F),e.set(1,1,z),e.set(1,2,H),e.set(2,0,O),e.set(2,1,U),e.set(2,2,L),e}mmulStrassen(t){t=S.checkMatrix(t);let e=this.clone(),r=e.rows,o=e.columns,s=t.rows,n=t.columns;function i(t,e,r){let o=t.rows,s=t.columns;if(o===e&&s===r)return t;{let o=v.zeros(e,r);return o=o.setSubMatrix(t,0,0),o}}o!==s&&console.warn(`Multiplying ${r} x ${o} and ${s} x ${n} matrix: dimensions do not match.`);let h=Math.max(r,s),l=Math.max(o,n);return e=i(e,h,l),function t(e,r,o,s){if(o<=512||s<=512)return e.mmul(r);o%2==1&&s%2==1?(e=i(e,o+1,s+1),r=i(r,o+1,s+1)):o%2==1?(e=i(e,o+1,s),r=i(r,o+1,s)):s%2==1&&(e=i(e,o,s+1),r=i(r,o,s+1));let n=parseInt(e.rows/2,10),h=parseInt(e.columns/2,10),l=e.subMatrix(0,n-1,0,h-1),u=r.subMatrix(0,n-1,0,h-1),a=e.subMatrix(0,n-1,h,e.columns-1),c=r.subMatrix(0,n-1,h,r.columns-1),f=e.subMatrix(n,e.rows-1,0,h-1),m=r.subMatrix(n,r.rows-1,0,h-1),g=e.subMatrix(n,e.rows-1,h,e.columns-1),w=r.subMatrix(n,r.rows-1,h,r.columns-1),p=t(v.add(l,g),v.add(u,w),n,h),d=t(v.add(f,g),u,n,h),y=t(l,v.sub(c,w),n,h),x=t(g,v.sub(m,u),n,h),M=t(v.add(l,a),w,n,h),b=t(v.sub(f,l),v.add(u,c),n,h),E=t(v.sub(a,g),v.add(m,w),n,h),S=v.add(p,x);S.sub(M),S.add(E);let k=v.add(y,M),R=v.add(d,x),I=v.sub(p,d);I.add(y),I.add(b);let T=v.zeros(2*S.rows,2*S.columns);return T=T.setSubMatrix(S,0,0),T=T.setSubMatrix(k,S.rows,0),T=T.setSubMatrix(R,0,S.columns),T=T.setSubMatrix(I,S.rows,S.columns),T.subMatrix(0,o-1,0,s-1)}(e,t=i(t,h,l),h,l)}scaleRows(t={}){if("object"!=typeof t)throw new TypeError("options must be an object");const{min:e=0,max:r=1}=t;if(!Number.isFinite(e))throw new TypeError("min must be a number");if(!Number.isFinite(r))throw new TypeError("max must be a number");if(e>=r)throw new RangeError("min must be smaller than max");let o=new S(this.rows,this.columns);for(let t=0;t<this.rows;t++){const s=this.getRow(t);h(s,{min:e,max:r,output:s}),o.setRow(t,s)}return o}scaleColumns(t={}){if("object"!=typeof t)throw new TypeError("options must be an object");const{min:e=0,max:r=1}=t;if(!Number.isFinite(e))throw new TypeError("min must be a number");if(!Number.isFinite(r))throw new TypeError("max must be a number");if(e>=r)throw new RangeError("min must be smaller than max");let o=new S(this.rows,this.columns);for(let t=0;t<this.columns;t++){const s=this.getColumn(t);h(s,{min:e,max:r,output:s}),o.setColumn(t,s)}return o}flipRows(){const t=Math.ceil(this.columns/2);for(let e=0;e<this.rows;e++)for(let r=0;r<t;r++){let t=this.get(e,r),o=this.get(e,this.columns-1-r);this.set(e,r,o),this.set(e,this.columns-1-r,t)}return this}flipColumns(){const t=Math.ceil(this.rows/2);for(let e=0;e<this.columns;e++)for(let r=0;r<t;r++){let t=this.get(r,e),o=this.get(this.rows-1-r,e);this.set(r,e,o),this.set(this.rows-1-r,e,t)}return this}kroneckerProduct(t){t=S.checkMatrix(t);let e=this.rows,r=this.columns,o=t.rows,s=t.columns,n=new S(e*o,r*s);for(let i=0;i<e;i++)for(let e=0;e<r;e++)for(let r=0;r<o;r++)for(let h=0;h<s;h++)n.set(o*i+r,s*e+h,this.get(i,e)*t.get(r,h));return n}transpose(){let t=new S(this.columns,this.rows);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t.set(r,e,this.get(e,r));return t}sortRows(t=E){for(let e=0;e<this.rows;e++)this.setRow(e,this.getRow(e).sort(t));return this}sortColumns(t=E){for(let e=0;e<this.columns;e++)this.setColumn(e,this.getColumn(e).sort(t));return this}subMatrix(t,e,r,o){x(this,t,e,r,o);let s=new S(e-t+1,o-r+1);for(let n=t;n<=e;n++)for(let e=r;e<=o;e++)s.set(n-t,e-r,this.get(n,e));return s}subMatrixRow(t,e,r){if(void 0===e&&(e=0),void 0===r&&(r=this.columns-1),e>r||e<0||e>=this.columns||r<0||r>=this.columns)throw new RangeError("Argument out of range");let o=new S(t.length,r-e+1);for(let s=0;s<t.length;s++)for(let n=e;n<=r;n++){if(t[s]<0||t[s]>=this.rows)throw new RangeError("Row index out of range: "+t[s]);o.set(s,n-e,this.get(t[s],n))}return o}subMatrixColumn(t,e,r){if(void 0===e&&(e=0),void 0===r&&(r=this.rows-1),e>r||e<0||e>=this.rows||r<0||r>=this.rows)throw new RangeError("Argument out of range");let o=new S(r-e+1,t.length);for(let s=0;s<t.length;s++)for(let n=e;n<=r;n++){if(t[s]<0||t[s]>=this.columns)throw new RangeError("Column index out of range: "+t[s]);o.set(n-e,s,this.get(n,t[s]))}return o}setSubMatrix(t,e,r){x(this,e,e+(t=S.checkMatrix(t)).rows-1,r,r+t.columns-1);for(let o=0;o<t.rows;o++)for(let s=0;s<t.columns;s++)this.set(e+o,r+s,t.get(o,s));return this}selection(t,e){let r=p(this,t,e),o=new S(t.length,e.length);for(let t=0;t<r.row.length;t++){let e=r.row[t];for(let s=0;s<r.column.length;s++){let n=r.column[s];o.set(t,s,this.get(e,n))}}return o}trace(){let t=Math.min(this.rows,this.columns),e=0;for(let r=0;r<t;r++)e+=this.get(r,r);return e}clone(){let t=new S(this.rows,this.columns);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t.set(e,r,this.get(e,r));return t}sum(t){switch(t){case"row":return function(t){let e=M(t.rows);for(let r=0;r<t.rows;++r)for(let o=0;o<t.columns;++o)e[r]+=t.get(r,o);return e}(this);case"column":return function(t){let e=M(t.columns);for(let r=0;r<t.rows;++r)for(let o=0;o<t.columns;++o)e[o]+=t.get(r,o);return e}(this);case void 0:return function(t){let e=0;for(let r=0;r<t.rows;r++)for(let o=0;o<t.columns;o++)e+=t.get(r,o);return e}(this);default:throw new Error("invalid option: "+t)}}product(t){switch(t){case"row":return function(t){let e=M(t.rows,1);for(let r=0;r<t.rows;++r)for(let o=0;o<t.columns;++o)e[r]*=t.get(r,o);return e}(this);case"column":return function(t){let e=M(t.columns,1);for(let r=0;r<t.rows;++r)for(let o=0;o<t.columns;++o)e[o]*=t.get(r,o);return e}(this);case void 0:return function(t){let e=1;for(let r=0;r<t.rows;r++)for(let o=0;o<t.columns;o++)e*=t.get(r,o);return e}(this);default:throw new Error("invalid option: "+t)}}mean(t){const e=this.sum(t);switch(t){case"row":for(let t=0;t<this.rows;t++)e[t]/=this.columns;return e;case"column":for(let t=0;t<this.columns;t++)e[t]/=this.rows;return e;case void 0:return e/this.size;default:throw new Error("invalid option: "+t)}}variance(t,e={}){if("object"==typeof t&&(e=t,t=void 0),"object"!=typeof e)throw new TypeError("options must be an object");const{unbiased:r=!0,mean:o=this.mean(t)}=e;if("boolean"!=typeof r)throw new TypeError("unbiased must be a boolean");switch(t){case"row":if(!Array.isArray(o))throw new TypeError("mean must be an array");return function(t,e,r){const o=t.rows,s=t.columns,n=[];for(let i=0;i<o;i++){let o=0,h=0,l=0;for(let e=0;e<s;e++)l=t.get(i,e)-r[i],o+=l,h+=l*l;e?n.push((h-o*o/s)/(s-1)):n.push((h-o*o/s)/s)}return n}(this,r,o);case"column":if(!Array.isArray(o))throw new TypeError("mean must be an array");return function(t,e,r){const o=t.rows,s=t.columns,n=[];for(let i=0;i<s;i++){let s=0,h=0,l=0;for(let e=0;e<o;e++)l=t.get(e,i)-r[i],s+=l,h+=l*l;e?n.push((h-s*s/o)/(o-1)):n.push((h-s*s/o)/o)}return n}(this,r,o);case void 0:if("number"!=typeof o)throw new TypeError("mean must be a number");return function(t,e,r){const o=t.rows,s=t.columns,n=o*s;let i=0,h=0,l=0;for(let e=0;e<o;e++)for(let o=0;o<s;o++)l=t.get(e,o)-r,i+=l,h+=l*l;return e?(h-i*i/n)/(n-1):(h-i*i/n)/n}(this,r,o);default:throw new Error("invalid option: "+t)}}standardDeviation(t,e){"object"==typeof t&&(e=t,t=void 0);const r=this.variance(t,e);if(void 0===t)return Math.sqrt(r);for(let t=0;t<r.length;t++)r[t]=Math.sqrt(r[t]);return r}center(t,e={}){if("object"==typeof t&&(e=t,t=void 0),"object"!=typeof e)throw new TypeError("options must be an object");const{center:r=this.mean(t)}=e;switch(t){case"row":if(!Array.isArray(r))throw new TypeError("center must be an array");return function(t,e){for(let r=0;r<t.rows;r++)for(let o=0;o<t.columns;o++)t.set(r,o,t.get(r,o)-e[r])}(this,r),this;case"column":if(!Array.isArray(r))throw new TypeError("center must be an array");return function(t,e){for(let r=0;r<t.rows;r++)for(let o=0;o<t.columns;o++)t.set(r,o,t.get(r,o)-e[o])}(this,r),this;case void 0:if("number"!=typeof r)throw new TypeError("center must be a number");return function(t,e){for(let r=0;r<t.rows;r++)for(let o=0;o<t.columns;o++)t.set(r,o,t.get(r,o)-e)}(this,r),this;default:throw new Error("invalid option: "+t)}}scale(t,e={}){if("object"==typeof t&&(e=t,t=void 0),"object"!=typeof e)throw new TypeError("options must be an object");let r=e.scale;switch(t){case"row":if(void 0===r)r=function(t){const e=[];for(let r=0;r<t.rows;r++){let o=0;for(let e=0;e<t.columns;e++)o+=Math.pow(t.get(r,e),2)/(t.columns-1);e.push(Math.sqrt(o))}return e}(this);else if(!Array.isArray(r))throw new TypeError("scale must be an array");return function(t,e){for(let r=0;r<t.rows;r++)for(let o=0;o<t.columns;o++)t.set(r,o,t.get(r,o)/e[r])}(this,r),this;case"column":if(void 0===r)r=function(t){const e=[];for(let r=0;r<t.columns;r++){let o=0;for(let e=0;e<t.rows;e++)o+=Math.pow(t.get(e,r),2)/(t.rows-1);e.push(Math.sqrt(o))}return e}(this);else if(!Array.isArray(r))throw new TypeError("scale must be an array");return function(t,e){for(let r=0;r<t.rows;r++)for(let o=0;o<t.columns;o++)t.set(r,o,t.get(r,o)/e[o])}(this,r),this;case void 0:if(void 0===r)r=function(t){const e=t.size-1;let r=0;for(let o=0;o<t.columns;o++)for(let s=0;s<t.rows;s++)r+=Math.pow(t.get(s,o),2)/e;return Math.sqrt(r)}(this);else if("number"!=typeof r)throw new TypeError("scale must be a number");return function(t,e){for(let r=0;r<t.rows;r++)for(let o=0;o<t.columns;o++)t.set(r,o,t.get(r,o)/e)}(this,r),this;default:throw new Error("invalid option: "+t)}}toString(t){return a(this,t)}}function E(t,e){return t-e}v.prototype.klass="Matrix","undefined"!=typeof Symbol&&(v.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return a(this)}),v.random=v.rand,v.randomInt=v.randInt,v.diagonal=v.diag,v.prototype.diagonal=v.prototype.diag,v.identity=v.eye,v.prototype.negate=v.prototype.neg,v.prototype.tensorProduct=v.prototype.kroneckerProduct;class S extends v{constructor(t,e){if(super(),S.isMatrix(t))return t.clone();if(Number.isInteger(t)&&t>0){if(this.data=[],!(Number.isInteger(e)&&e>0))throw new TypeError("nColumns must be a positive integer");for(let r=0;r<t;r++)this.data.push(new Float64Array(e))}else{if(!Array.isArray(t))throw new TypeError("First argument must be a positive number or an array");{const r=t;if(t=r.length,"number"!=typeof(e=r[0].length)||0===e)throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let o=0;o<t;o++){if(r[o].length!==e)throw new RangeError("Inconsistent array dimensions");this.data.push(Float64Array.from(r[o]))}}}return this.rows=t,this.columns=e,this}set(t,e,r){return this.data[t][e]=r,this}get(t,e){return this.data[t][e]}removeRow(t){if(f(this,t),1===this.rows)throw new RangeError("A matrix cannot have less than one row");return this.data.splice(t,1),this.rows-=1,this}addRow(t,e){return void 0===e&&(e=t,t=this.rows),f(this,t,!0),e=Float64Array.from(g(this,e)),this.data.splice(t,0,e),this.rows+=1,this}removeColumn(t){if(m(this,t),1===this.columns)throw new RangeError("A matrix cannot have less than one column");for(let e=0;e<this.rows;e++){const r=new Float64Array(this.columns-1);for(let o=0;o<t;o++)r[o]=this.data[e][o];for(let o=t+1;o<this.columns;o++)r[o-1]=this.data[e][o];this.data[e]=r}return this.columns-=1,this}addColumn(t,e){void 0===e&&(e=t,t=this.columns),m(this,t,!0),e=w(this,e);for(let r=0;r<this.rows;r++){const o=new Float64Array(this.columns+1);let s=0;for(;s<t;s++)o[s]=this.data[r][s];for(o[s++]=e[r];s<this.columns+1;s++)o[s]=this.data[r][s-1];this.data[r]=o}return this.columns+=1,this}}var k,R;R=S,(k=v).prototype.add=function(t){return"number"==typeof t?this.addS(t):this.addM(t)},k.prototype.addS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)+t);return this},k.prototype.addM=function(t){if(t=R.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)+t.get(e,r));return this},k.add=function(t,e){return new R(t).add(e)},k.prototype.sub=function(t){return"number"==typeof t?this.subS(t):this.subM(t)},k.prototype.subS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)-t);return this},k.prototype.subM=function(t){if(t=R.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)-t.get(e,r));return this},k.sub=function(t,e){return new R(t).sub(e)},k.prototype.subtract=k.prototype.sub,k.prototype.subtractS=k.prototype.subS,k.prototype.subtractM=k.prototype.subM,k.subtract=k.sub,k.prototype.mul=function(t){return"number"==typeof t?this.mulS(t):this.mulM(t)},k.prototype.mulS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)*t);return this},k.prototype.mulM=function(t){if(t=R.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)*t.get(e,r));return this},k.mul=function(t,e){return new R(t).mul(e)},k.prototype.multiply=k.prototype.mul,k.prototype.multiplyS=k.prototype.mulS,k.prototype.multiplyM=k.prototype.mulM,k.multiply=k.mul,k.prototype.div=function(t){return"number"==typeof t?this.divS(t):this.divM(t)},k.prototype.divS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)/t);return this},k.prototype.divM=function(t){if(t=R.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)/t.get(e,r));return this},k.div=function(t,e){return new R(t).div(e)},k.prototype.divide=k.prototype.div,k.prototype.divideS=k.prototype.divS,k.prototype.divideM=k.prototype.divM,k.divide=k.div,k.prototype.mod=function(t){return"number"==typeof t?this.modS(t):this.modM(t)},k.prototype.modS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)%t);return this},k.prototype.modM=function(t){if(t=R.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)%t.get(e,r));return this},k.mod=function(t,e){return new R(t).mod(e)},k.prototype.modulus=k.prototype.mod,k.prototype.modulusS=k.prototype.modS,k.prototype.modulusM=k.prototype.modM,k.modulus=k.mod,k.prototype.and=function(t){return"number"==typeof t?this.andS(t):this.andM(t)},k.prototype.andS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)&t);return this},k.prototype.andM=function(t){if(t=R.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)&t.get(e,r));return this},k.and=function(t,e){return new R(t).and(e)},k.prototype.or=function(t){return"number"==typeof t?this.orS(t):this.orM(t)},k.prototype.orS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)|t);return this},k.prototype.orM=function(t){if(t=R.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)|t.get(e,r));return this},k.or=function(t,e){return new R(t).or(e)},k.prototype.xor=function(t){return"number"==typeof t?this.xorS(t):this.xorM(t)},k.prototype.xorS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)^t);return this},k.prototype.xorM=function(t){if(t=R.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)^t.get(e,r));return this},k.xor=function(t,e){return new R(t).xor(e)},k.prototype.leftShift=function(t){return"number"==typeof t?this.leftShiftS(t):this.leftShiftM(t)},k.prototype.leftShiftS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)<<t);return this},k.prototype.leftShiftM=function(t){if(t=R.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)<<t.get(e,r));return this},k.leftShift=function(t,e){return new R(t).leftShift(e)},k.prototype.signPropagatingRightShift=function(t){return"number"==typeof t?this.signPropagatingRightShiftS(t):this.signPropagatingRightShiftM(t)},k.prototype.signPropagatingRightShiftS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)>>t);return this},k.prototype.signPropagatingRightShiftM=function(t){if(t=R.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)>>t.get(e,r));return this},k.signPropagatingRightShift=function(t,e){return new R(t).signPropagatingRightShift(e)},k.prototype.rightShift=function(t){return"number"==typeof t?this.rightShiftS(t):this.rightShiftM(t)},k.prototype.rightShiftS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)>>>t);return this},k.prototype.rightShiftM=function(t){if(t=R.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)>>>t.get(e,r));return this},k.rightShift=function(t,e){return new R(t).rightShift(e)},k.prototype.zeroFillRightShift=k.prototype.rightShift,k.prototype.zeroFillRightShiftS=k.prototype.rightShiftS,k.prototype.zeroFillRightShiftM=k.prototype.rightShiftM,k.zeroFillRightShift=k.rightShift,k.prototype.not=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,~this.get(t,e));return this},k.not=function(t){return new R(t).not()},k.prototype.abs=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.abs(this.get(t,e)));return this},k.abs=function(t){return new R(t).abs()},k.prototype.acos=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.acos(this.get(t,e)));return this},k.acos=function(t){return new R(t).acos()},k.prototype.acosh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.acosh(this.get(t,e)));return this},k.acosh=function(t){return new R(t).acosh()},k.prototype.asin=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.asin(this.get(t,e)));return this},k.asin=function(t){return new R(t).asin()},k.prototype.asinh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.asinh(this.get(t,e)));return this},k.asinh=function(t){return new R(t).asinh()},k.prototype.atan=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.atan(this.get(t,e)));return this},k.atan=function(t){return new R(t).atan()},k.prototype.atanh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.atanh(this.get(t,e)));return this},k.atanh=function(t){return new R(t).atanh()},k.prototype.cbrt=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.cbrt(this.get(t,e)));return this},k.cbrt=function(t){return new R(t).cbrt()},k.prototype.ceil=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.ceil(this.get(t,e)));return this},k.ceil=function(t){return new R(t).ceil()},k.prototype.clz32=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.clz32(this.get(t,e)));return this},k.clz32=function(t){return new R(t).clz32()},k.prototype.cos=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.cos(this.get(t,e)));return this},k.cos=function(t){return new R(t).cos()},k.prototype.cosh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.cosh(this.get(t,e)));return this},k.cosh=function(t){return new R(t).cosh()},k.prototype.exp=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.exp(this.get(t,e)));return this},k.exp=function(t){return new R(t).exp()},k.prototype.expm1=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.expm1(this.get(t,e)));return this},k.expm1=function(t){return new R(t).expm1()},k.prototype.floor=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.floor(this.get(t,e)));return this},k.floor=function(t){return new R(t).floor()},k.prototype.fround=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.fround(this.get(t,e)));return this},k.fround=function(t){return new R(t).fround()},k.prototype.log=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log(this.get(t,e)));return this},k.log=function(t){return new R(t).log()},k.prototype.log1p=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log1p(this.get(t,e)));return this},k.log1p=function(t){return new R(t).log1p()},k.prototype.log10=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log10(this.get(t,e)));return this},k.log10=function(t){return new R(t).log10()},k.prototype.log2=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log2(this.get(t,e)));return this},k.log2=function(t){return new R(t).log2()},k.prototype.round=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.round(this.get(t,e)));return this},k.round=function(t){return new R(t).round()},k.prototype.sign=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sign(this.get(t,e)));return this},k.sign=function(t){return new R(t).sign()},k.prototype.sin=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sin(this.get(t,e)));return this},k.sin=function(t){return new R(t).sin()},k.prototype.sinh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sinh(this.get(t,e)));return this},k.sinh=function(t){return new R(t).sinh()},k.prototype.sqrt=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sqrt(this.get(t,e)));return this},k.sqrt=function(t){return new R(t).sqrt()},k.prototype.tan=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.tan(this.get(t,e)));return this},k.tan=function(t){return new R(t).tan()},k.prototype.tanh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.tanh(this.get(t,e)));return this},k.tanh=function(t){return new R(t).tanh()},k.prototype.trunc=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.trunc(this.get(t,e)));return this},k.trunc=function(t){return new R(t).trunc()},k.pow=function(t,e){return new R(t).pow(e)},k.prototype.pow=function(t){return"number"==typeof t?this.powS(t):this.powM(t)},k.prototype.powS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.pow(this.get(e,r),t));return this},k.prototype.powM=function(t){if(t=R.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.pow(this.get(e,r),t.get(e,r)));return this};class I extends v{constructor(t,e,r){super(),this.matrix=t,this.rows=e,this.columns=r}}class T extends I{constructor(t,e){m(t,e),super(t,t.rows,1),this.column=e}set(t,e,r){return this.matrix.set(t,this.column,r),this}get(t){return this.matrix.get(t,this.column)}}class q extends I{constructor(t,e){e=y(t,e),super(t,t.rows,e.length),this.columnIndices=e}set(t,e,r){return this.matrix.set(t,this.columnIndices[e],r),this}get(t,e){return this.matrix.get(t,this.columnIndices[e])}}class A extends I{constructor(t){super(t,t.rows,t.columns)}set(t,e,r){return this.matrix.set(t,this.columns-e-1,r),this}get(t,e){return this.matrix.get(t,this.columns-e-1)}}class C extends I{constructor(t){super(t,t.rows,t.columns)}set(t,e,r){return this.matrix.set(this.rows-t-1,e,r),this}get(t,e){return this.matrix.get(this.rows-t-1,e)}}class V extends I{constructor(t,e){f(t,e),super(t,1,t.columns),this.row=e}set(t,e,r){return this.matrix.set(this.row,e,r),this}get(t,e){return this.matrix.get(this.row,e)}}class P extends I{constructor(t,e){super(t,(e=d(t,e)).length,t.columns),this.rowIndices=e}set(t,e,r){return this.matrix.set(this.rowIndices[t],e,r),this}get(t,e){return this.matrix.get(this.rowIndices[t],e)}}class N extends I{constructor(t,e,r){let o=p(t,e,r);super(t,o.row.length,o.column.length),this.rowIndices=o.row,this.columnIndices=o.column}set(t,e,r){return this.matrix.set(this.rowIndices[t],this.columnIndices[e],r),this}get(t,e){return this.matrix.get(this.rowIndices[t],this.columnIndices[e])}}class D extends I{constructor(t,e,r,o,s){x(t,e,r,o,s),super(t,r-e+1,s-o+1),this.startRow=e,this.startColumn=o}set(t,e,r){return this.matrix.set(this.startRow+t,this.startColumn+e,r),this}get(t,e){return this.matrix.get(this.startRow+t,this.startColumn+e)}}class j extends I{constructor(t){super(t,t.columns,t.rows)}set(t,e,r){return this.matrix.set(e,t,r),this}get(t,e){return this.matrix.get(e,t)}}class _ extends v{constructor(t,e={}){const{rows:r=1}=e;if(t.length%r!=0)throw new Error("the data length is not divisible by the number of rows");super(),this.rows=r,this.columns=t.length/r,this.data=t}set(t,e,r){let o=this._calculateIndex(t,e);return this.data[o]=r,this}get(t,e){let r=this._calculateIndex(t,e);return this.data[r]}_calculateIndex(t,e){return t*this.columns+e}}class F extends v{constructor(t){super(),this.data=t,this.rows=t.length,this.columns=t[0].length}set(t,e,r){return this.data[t][e]=r,this}get(t,e){return this.data[t][e]}}function z(t,e){if(Array.isArray(t))return t[0]&&Array.isArray(t[0])?new F(t):new _(t,e);throw new Error("the argument is not an array")}class H{constructor(t){let e,r,o,s,n,i,h,l,u,a=(t=F.checkMatrix(t)).clone(),c=a.rows,f=a.columns,m=new Float64Array(c),g=1;for(e=0;e<c;e++)m[e]=e;for(l=new Float64Array(c),r=0;r<f;r++){for(e=0;e<c;e++)l[e]=a.get(e,r);for(e=0;e<c;e++){for(u=Math.min(e,r),n=0,o=0;o<u;o++)n+=a.get(e,o)*l[o];l[e]-=n,a.set(e,r,l[e])}for(s=r,e=r+1;e<c;e++)Math.abs(l[e])>Math.abs(l[s])&&(s=e);if(s!==r){for(o=0;o<f;o++)i=a.get(s,o),a.set(s,o,a.get(r,o)),a.set(r,o,i);h=m[s],m[s]=m[r],m[r]=h,g=-g}if(r<c&&0!==a.get(r,r))for(e=r+1;e<c;e++)a.set(e,r,a.get(e,r)/a.get(r,r))}this.LU=a,this.pivotVector=m,this.pivotSign=g}isSingular(){let t=this.LU,e=t.columns;for(let r=0;r<e;r++)if(0===t.get(r,r))return!0;return!1}solve(t){t=S.checkMatrix(t);let e=this.LU;if(e.rows!==t.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");let r,o,s,n=t.columns,i=t.subMatrixRow(this.pivotVector,0,n-1),h=e.columns;for(s=0;s<h;s++)for(r=s+1;r<h;r++)for(o=0;o<n;o++)i.set(r,o,i.get(r,o)-i.get(s,o)*e.get(r,s));for(s=h-1;s>=0;s--){for(o=0;o<n;o++)i.set(s,o,i.get(s,o)/e.get(s,s));for(r=0;r<s;r++)for(o=0;o<n;o++)i.set(r,o,i.get(r,o)-i.get(s,o)*e.get(r,s))}return i}get determinant(){let t=this.LU;if(!t.isSquare())throw new Error("Matrix must be square");let e=this.pivotSign,r=t.columns;for(let o=0;o<r;o++)e*=t.get(o,o);return e}get lowerTriangularMatrix(){let t=this.LU,e=t.rows,r=t.columns,o=new S(e,r);for(let s=0;s<e;s++)for(let e=0;e<r;e++)s>e?o.set(s,e,t.get(s,e)):s===e?o.set(s,e,1):o.set(s,e,0);return o}get upperTriangularMatrix(){let t=this.LU,e=t.rows,r=t.columns,o=new S(e,r);for(let s=0;s<e;s++)for(let e=0;e<r;e++)s<=e?o.set(s,e,t.get(s,e)):o.set(s,e,0);return o}get pivotPermutationVector(){return Array.from(this.pivotVector)}}function O(t,e){let r=0;return Math.abs(t)>Math.abs(e)?(r=e/t,Math.abs(t)*Math.sqrt(1+r*r)):0!==e?(r=t/e,Math.abs(e)*Math.sqrt(1+r*r)):0}class U{constructor(t){let e,r,o,s,n=(t=F.checkMatrix(t)).clone(),i=t.rows,h=t.columns,l=new Float64Array(h);for(o=0;o<h;o++){let t=0;for(e=o;e<i;e++)t=O(t,n.get(e,o));if(0!==t){for(n.get(o,o)<0&&(t=-t),e=o;e<i;e++)n.set(e,o,n.get(e,o)/t);for(n.set(o,o,n.get(o,o)+1),r=o+1;r<h;r++){for(s=0,e=o;e<i;e++)s+=n.get(e,o)*n.get(e,r);for(s=-s/n.get(o,o),e=o;e<i;e++)n.set(e,r,n.get(e,r)+s*n.get(e,o))}}l[o]=-t}this.QR=n,this.Rdiag=l}solve(t){t=S.checkMatrix(t);let e=this.QR,r=e.rows;if(t.rows!==r)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");let o,s,n,i,h=t.columns,l=t.clone(),u=e.columns;for(n=0;n<u;n++)for(s=0;s<h;s++){for(i=0,o=n;o<r;o++)i+=e.get(o,n)*l.get(o,s);for(i=-i/e.get(n,n),o=n;o<r;o++)l.set(o,s,l.get(o,s)+i*e.get(o,n))}for(n=u-1;n>=0;n--){for(s=0;s<h;s++)l.set(n,s,l.get(n,s)/this.Rdiag[n]);for(o=0;o<n;o++)for(s=0;s<h;s++)l.set(o,s,l.get(o,s)-l.get(n,s)*e.get(o,n))}return l.subMatrix(0,u-1,0,h-1)}isFullRank(){let t=this.QR.columns;for(let e=0;e<t;e++)if(0===this.Rdiag[e])return!1;return!0}get upperTriangularMatrix(){let t,e,r=this.QR,o=r.columns,s=new S(o,o);for(t=0;t<o;t++)for(e=0;e<o;e++)t<e?s.set(t,e,r.get(t,e)):t===e?s.set(t,e,this.Rdiag[t]):s.set(t,e,0);return s}get orthogonalMatrix(){let t,e,r,o,s=this.QR,n=s.rows,i=s.columns,h=new S(n,i);for(r=i-1;r>=0;r--){for(t=0;t<n;t++)h.set(t,r,0);for(h.set(r,r,1),e=r;e<i;e++)if(0!==s.get(r,r)){for(o=0,t=r;t<n;t++)o+=s.get(t,r)*h.get(t,e);for(o=-o/s.get(r,r),t=r;t<n;t++)h.set(t,e,h.get(t,e)+o*s.get(t,r))}}return h}}class L{constructor(t,e={}){let r=(t=F.checkMatrix(t)).rows,o=t.columns;const{computeLeftSingularVectors:s=!0,computeRightSingularVectors:n=!0,autoTranspose:i=!1}=e;let h,l=Boolean(s),u=Boolean(n),a=!1;if(r<o)if(i){h=t.transpose(),r=h.rows,o=h.columns,a=!0;let e=l;l=u,u=e}else h=t.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else h=t.clone();let c=Math.min(r,o),f=Math.min(r+1,o),m=new Float64Array(f),g=new S(r,c),w=new S(o,o),p=new Float64Array(o),d=new Float64Array(r),y=new Float64Array(f);for(let t=0;t<f;t++)y[t]=t;let x=Math.min(r-1,o),M=Math.max(0,Math.min(o-2,r)),b=Math.max(x,M);for(let t=0;t<b;t++){if(t<x){m[t]=0;for(let e=t;e<r;e++)m[t]=O(m[t],h.get(e,t));if(0!==m[t]){h.get(t,t)<0&&(m[t]=-m[t]);for(let e=t;e<r;e++)h.set(e,t,h.get(e,t)/m[t]);h.set(t,t,h.get(t,t)+1)}m[t]=-m[t]}for(let e=t+1;e<o;e++){if(t<x&&0!==m[t]){let o=0;for(let s=t;s<r;s++)o+=h.get(s,t)*h.get(s,e);o=-o/h.get(t,t);for(let s=t;s<r;s++)h.set(s,e,h.get(s,e)+o*h.get(s,t))}p[e]=h.get(t,e)}if(l&&t<x)for(let e=t;e<r;e++)g.set(e,t,h.get(e,t));if(t<M){p[t]=0;for(let e=t+1;e<o;e++)p[t]=O(p[t],p[e]);if(0!==p[t]){p[t+1]<0&&(p[t]=0-p[t]);for(let e=t+1;e<o;e++)p[e]/=p[t];p[t+1]+=1}if(p[t]=-p[t],t+1<r&&0!==p[t]){for(let e=t+1;e<r;e++)d[e]=0;for(let e=t+1;e<r;e++)for(let r=t+1;r<o;r++)d[e]+=p[r]*h.get(e,r);for(let e=t+1;e<o;e++){let o=-p[e]/p[t+1];for(let s=t+1;s<r;s++)h.set(s,e,h.get(s,e)+o*d[s])}}if(u)for(let e=t+1;e<o;e++)w.set(e,t,p[e])}}let v=Math.min(o,r+1);if(x<o&&(m[x]=h.get(x,x)),r<v&&(m[v-1]=0),M+1<v&&(p[M]=h.get(M,v-1)),p[v-1]=0,l){for(let t=x;t<c;t++){for(let e=0;e<r;e++)g.set(e,t,0);g.set(t,t,1)}for(let t=x-1;t>=0;t--)if(0!==m[t]){for(let e=t+1;e<c;e++){let o=0;for(let s=t;s<r;s++)o+=g.get(s,t)*g.get(s,e);o=-o/g.get(t,t);for(let s=t;s<r;s++)g.set(s,e,g.get(s,e)+o*g.get(s,t))}for(let e=t;e<r;e++)g.set(e,t,-g.get(e,t));g.set(t,t,1+g.get(t,t));for(let e=0;e<t-1;e++)g.set(e,t,0)}else{for(let e=0;e<r;e++)g.set(e,t,0);g.set(t,t,1)}}if(u)for(let t=o-1;t>=0;t--){if(t<M&&0!==p[t])for(let e=t+1;e<o;e++){let r=0;for(let s=t+1;s<o;s++)r+=w.get(s,t)*w.get(s,e);r=-r/w.get(t+1,t);for(let s=t+1;s<o;s++)w.set(s,e,w.get(s,e)+r*w.get(s,t))}for(let e=0;e<o;e++)w.set(e,t,0);w.set(t,t,1)}let E=v-1,k=0,R=Number.EPSILON;for(;v>0;){let t,e;for(t=v-2;t>=-1&&-1!==t;t--){const e=Number.MIN_VALUE+R*Math.abs(m[t]+Math.abs(m[t+1]));if(Math.abs(p[t])<=e||Number.isNaN(p[t])){p[t]=0;break}}if(t===v-2)e=4;else{let r;for(r=v-1;r>=t&&r!==t;r--){let e=(r!==v?Math.abs(p[r]):0)+(r!==t+1?Math.abs(p[r-1]):0);if(Math.abs(m[r])<=R*e){m[r]=0;break}}r===t?e=3:r===v-1?e=1:(e=2,t=r)}switch(t++,e){case 1:{let e=p[v-2];p[v-2]=0;for(let r=v-2;r>=t;r--){let s=O(m[r],e),n=m[r]/s,i=e/s;if(m[r]=s,r!==t&&(e=-i*p[r-1],p[r-1]=n*p[r-1]),u)for(let t=0;t<o;t++)s=n*w.get(t,r)+i*w.get(t,v-1),w.set(t,v-1,-i*w.get(t,r)+n*w.get(t,v-1)),w.set(t,r,s)}break}case 2:{let e=p[t-1];p[t-1]=0;for(let o=t;o<v;o++){let s=O(m[o],e),n=m[o]/s,i=e/s;if(m[o]=s,e=-i*p[o],p[o]=n*p[o],l)for(let e=0;e<r;e++)s=n*g.get(e,o)+i*g.get(e,t-1),g.set(e,t-1,-i*g.get(e,o)+n*g.get(e,t-1)),g.set(e,o,s)}break}case 3:{const e=Math.max(Math.abs(m[v-1]),Math.abs(m[v-2]),Math.abs(p[v-2]),Math.abs(m[t]),Math.abs(p[t])),s=m[v-1]/e,n=m[v-2]/e,i=p[v-2]/e,h=m[t]/e,a=p[t]/e,c=((n+s)*(n-s)+i*i)/2,f=s*i*(s*i);let d=0;0===c&&0===f||(d=c<0?0-Math.sqrt(c*c+f):Math.sqrt(c*c+f),d=f/(c+d));let y=(h+s)*(h-s)+d,x=h*a;for(let e=t;e<v-1;e++){let s=O(y,x);0===s&&(s=Number.MIN_VALUE);let n=y/s,i=x/s;if(e!==t&&(p[e-1]=s),y=n*m[e]+i*p[e],p[e]=n*p[e]-i*m[e],x=i*m[e+1],m[e+1]=n*m[e+1],u)for(let t=0;t<o;t++)s=n*w.get(t,e)+i*w.get(t,e+1),w.set(t,e+1,-i*w.get(t,e)+n*w.get(t,e+1)),w.set(t,e,s);if(s=O(y,x),0===s&&(s=Number.MIN_VALUE),n=y/s,i=x/s,m[e]=s,y=n*p[e]+i*m[e+1],m[e+1]=-i*p[e]+n*m[e+1],x=i*p[e+1],p[e+1]=n*p[e+1],l&&e<r-1)for(let t=0;t<r;t++)s=n*g.get(t,e)+i*g.get(t,e+1),g.set(t,e+1,-i*g.get(t,e)+n*g.get(t,e+1)),g.set(t,e,s)}p[v-2]=y,k+=1;break}case 4:if(m[t]<=0&&(m[t]=m[t]<0?-m[t]:0,u))for(let e=0;e<=E;e++)w.set(e,t,-w.get(e,t));for(;t<E&&!(m[t]>=m[t+1]);){let e=m[t];if(m[t]=m[t+1],m[t+1]=e,u&&t<o-1)for(let r=0;r<o;r++)e=w.get(r,t+1),w.set(r,t+1,w.get(r,t)),w.set(r,t,e);if(l&&t<r-1)for(let o=0;o<r;o++)e=g.get(o,t+1),g.set(o,t+1,g.get(o,t)),g.set(o,t,e);t++}k=0,v--}}if(a){let t=w;w=g,g=t}this.m=r,this.n=o,this.s=m,this.U=g,this.V=w}solve(t){let e=t,r=this.threshold,o=this.s.length,s=S.zeros(o,o);for(let t=0;t<o;t++)Math.abs(this.s[t])<=r?s.set(t,t,0):s.set(t,t,1/this.s[t]);let n=this.U,i=this.rightSingularVectors,h=i.mmul(s),l=i.rows,u=n.rows,a=S.zeros(l,u);for(let t=0;t<l;t++)for(let e=0;e<u;e++){let r=0;for(let s=0;s<o;s++)r+=h.get(t,s)*n.get(e,s);a.set(t,e,r)}return a.mmul(e)}solveForDiagonal(t){return this.solve(S.diag(t))}inverse(){let t=this.V,e=this.threshold,r=t.rows,o=t.columns,s=new S(r,this.s.length);for(let n=0;n<r;n++)for(let r=0;r<o;r++)Math.abs(this.s[r])>e&&s.set(n,r,t.get(n,r)/this.s[r]);let n=this.U,i=n.rows,h=n.columns,l=new S(r,i);for(let t=0;t<r;t++)for(let e=0;e<i;e++){let r=0;for(let o=0;o<h;o++)r+=s.get(t,o)*n.get(e,o);l.set(t,e,r)}return l}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){let t=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,e=0,r=this.s;for(let o=0,s=r.length;o<s;o++)r[o]>t&&e++;return e}get diagonal(){return Array.from(this.s)}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return this.U}get rightSingularVectors(){return this.V}get diagonalMatrix(){return S.diag(this.s)}}function $(t,e=!1){return t=F.checkMatrix(t),e?new L(t).inverse():G(t,S.eye(t.rows))}function G(t,e,r=!1){return t=F.checkMatrix(t),e=F.checkMatrix(e),r?new L(t).solve(e):t.isSquare()?new H(t).solve(e):new U(t).solve(e)}function X(t){if((t=S.checkMatrix(t)).isSquare()){let e,r,o,s;if(2===t.columns)return e=t.get(0,0),r=t.get(0,1),o=t.get(1,0),s=t.get(1,1),e*s-r*o;if(3===t.columns){let s,n,i;return s=new N(t,[1,2],[1,2]),n=new N(t,[1,2],[0,2]),i=new N(t,[1,2],[0,1]),e=t.get(0,0),r=t.get(0,1),o=t.get(0,2),e*X(s)-r*X(n)+o*X(i)}return new H(t).determinant}throw Error("determinant can only be calculated for a square matrix")}function B(t,e){let r=[];for(let o=0;o<t;o++)o!==e&&r.push(o);return r}function J(t,e,r,o=1e-9,s=1e-9){if(t>s)return new Array(e.rows+1).fill(0);{let t=e.addRow(r,[0]);for(let e=0;e<t.rows;e++)Math.abs(t.get(e,0))<o&&t.set(e,0,0);return t.to1DArray()}}function Q(t,e={}){const{thresholdValue:r=1e-9,thresholdError:o=1e-9}=e;let s=(t=S.checkMatrix(t)).rows,n=new S(s,s);for(let e=0;e<s;e++){let i=S.columnVector(t.getRow(e)),h=t.subMatrixRow(B(s,e)).transpose(),l=new L(h).solve(i),u=S.sub(i,h.mmul(l)).abs().max();n.setRow(e,J(u,l,e,r,o))}return n}function W(t,e=Number.EPSILON){t=S.checkMatrix(t);let r=new L(t,{autoTranspose:!0}),o=r.leftSingularVectors,s=r.rightSingularVectors,n=r.diagonal;for(let t=0;t<n.length;t++)Math.abs(n[t])>e?n[t]=1/n[t]:n[t]=0;return s.mmul(S.diag(n).mmul(o.transpose()))}function Y(t,e=t,r={}){t=new S(t);let o=!1;if("object"!=typeof e||S.isMatrix(e)||Array.isArray(e)?e=new S(e):(r=e,e=t,o=!0),t.rows!==e.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:s=!0}=r;s&&(t=t.center("column"),o||(e=e.center("column")));const n=t.transpose().mmul(e);for(let e=0;e<n.rows;e++)for(let r=0;r<n.columns;r++)n.set(e,r,n.get(e,r)*(1/(t.rows-1)));return n}function K(t,e=t,r={}){t=new S(t);let o=!1;if("object"!=typeof e||S.isMatrix(e)||Array.isArray(e)?e=new S(e):(r=e,e=t,o=!0),t.rows!==e.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:s=!0,scale:n=!0}=r;s&&(t.center("column"),o||e.center("column")),n&&(t.scale("column"),o||e.scale("column"));const i=t.standardDeviation("column",{unbiased:!0}),h=o?i:e.standardDeviation("column",{unbiased:!0}),l=t.transpose().mmul(e);for(let e=0;e<l.rows;e++)for(let r=0;r<l.columns;r++)l.set(e,r,l.get(e,r)*(1/(i[e]*h[r]))*(1/(t.rows-1)));return l}class Z{constructor(t,e={}){const{assumeSymmetric:r=!1}=e;if(!(t=F.checkMatrix(t)).isSquare())throw new Error("Matrix is not a square matrix");let o,s,n=t.columns,i=new S(n,n),h=new Float64Array(n),l=new Float64Array(n),u=t,a=!1;if(a=!!r||t.isSymmetric(),a){for(o=0;o<n;o++)for(s=0;s<n;s++)i.set(o,s,u.get(o,s));!function(t,e,r,o){let s,n,i,h,l,u,a,c;for(l=0;l<t;l++)r[l]=o.get(t-1,l);for(h=t-1;h>0;h--){for(c=0,i=0,u=0;u<h;u++)c+=Math.abs(r[u]);if(0===c)for(e[h]=r[h-1],l=0;l<h;l++)r[l]=o.get(h-1,l),o.set(h,l,0),o.set(l,h,0);else{for(u=0;u<h;u++)r[u]/=c,i+=r[u]*r[u];for(s=r[h-1],n=Math.sqrt(i),s>0&&(n=-n),e[h]=c*n,i-=s*n,r[h-1]=s-n,l=0;l<h;l++)e[l]=0;for(l=0;l<h;l++){for(s=r[l],o.set(l,h,s),n=e[l]+o.get(l,l)*s,u=l+1;u<=h-1;u++)n+=o.get(u,l)*r[u],e[u]+=o.get(u,l)*s;e[l]=n}for(s=0,l=0;l<h;l++)e[l]/=i,s+=e[l]*r[l];for(a=s/(i+i),l=0;l<h;l++)e[l]-=a*r[l];for(l=0;l<h;l++){for(s=r[l],n=e[l],u=l;u<=h-1;u++)o.set(u,l,o.get(u,l)-(s*e[u]+n*r[u]));r[l]=o.get(h-1,l),o.set(h,l,0)}}r[h]=i}for(h=0;h<t-1;h++){if(o.set(t-1,h,o.get(h,h)),o.set(h,h,1),i=r[h+1],0!==i){for(u=0;u<=h;u++)r[u]=o.get(u,h+1)/i;for(l=0;l<=h;l++){for(n=0,u=0;u<=h;u++)n+=o.get(u,h+1)*o.get(u,l);for(u=0;u<=h;u++)o.set(u,l,o.get(u,l)-n*r[u])}}for(u=0;u<=h;u++)o.set(u,h+1,0)}for(l=0;l<t;l++)r[l]=o.get(t-1,l),o.set(t-1,l,0);o.set(t-1,t-1,1),e[0]=0}(n,l,h,i),function(t,e,r,o){let s,n,i,h,l,u,a,c,f,m,g,w,p,d,y,x,M;for(i=1;i<t;i++)e[i-1]=e[i];e[t-1]=0;let b=0,v=0,E=Number.EPSILON;for(u=0;u<t;u++){for(v=Math.max(v,Math.abs(r[u])+Math.abs(e[u])),a=u;a<t&&!(Math.abs(e[a])<=E*v);)a++;if(a>u){M=0;do{for(M+=1,s=r[u],c=(r[u+1]-s)/(2*e[u]),f=O(c,1),c<0&&(f=-f),r[u]=e[u]/(c+f),r[u+1]=e[u]*(c+f),m=r[u+1],n=s-r[u],i=u+2;i<t;i++)r[i]-=n;for(b+=n,c=r[a],g=1,w=g,p=g,d=e[u+1],y=0,x=0,i=a-1;i>=u;i--)for(p=w,w=g,x=y,s=g*e[i],n=g*c,f=O(c,e[i]),e[i+1]=y*f,y=e[i]/f,g=c/f,c=g*r[i]-y*s,r[i+1]=n+y*(g*s+y*r[i]),l=0;l<t;l++)n=o.get(l,i+1),o.set(l,i+1,y*o.get(l,i)+g*n),o.set(l,i,g*o.get(l,i)-y*n);c=-y*x*p*d*e[u]/m,e[u]=y*c,r[u]=g*c}while(Math.abs(e[u])>E*v)}r[u]=r[u]+b,e[u]=0}for(i=0;i<t-1;i++){for(l=i,c=r[i],h=i+1;h<t;h++)r[h]<c&&(l=h,c=r[h]);if(l!==i)for(r[l]=r[i],r[i]=c,h=0;h<t;h++)c=o.get(h,i),o.set(h,i,o.get(h,l)),o.set(h,l,c)}}(n,l,h,i)}else{let t=new S(n,n),e=new Float64Array(n);for(s=0;s<n;s++)for(o=0;o<n;o++)t.set(o,s,u.get(o,s));!function(t,e,r,o){let s,n,i,h,l,u,a,c=t-1;for(u=1;u<=c-1;u++){for(a=0,h=u;h<=c;h++)a+=Math.abs(e.get(h,u-1));if(0!==a){for(i=0,h=c;h>=u;h--)r[h]=e.get(h,u-1)/a,i+=r[h]*r[h];for(n=Math.sqrt(i),r[u]>0&&(n=-n),i-=r[u]*n,r[u]=r[u]-n,l=u;l<t;l++){for(s=0,h=c;h>=u;h--)s+=r[h]*e.get(h,l);for(s/=i,h=u;h<=c;h++)e.set(h,l,e.get(h,l)-s*r[h])}for(h=0;h<=c;h++){for(s=0,l=c;l>=u;l--)s+=r[l]*e.get(h,l);for(s/=i,l=u;l<=c;l++)e.set(h,l,e.get(h,l)-s*r[l])}r[u]=a*r[u],e.set(u,u-1,a*n)}}for(h=0;h<t;h++)for(l=0;l<t;l++)o.set(h,l,h===l?1:0);for(u=c-1;u>=1;u--)if(0!==e.get(u,u-1)){for(h=u+1;h<=c;h++)r[h]=e.get(h,u-1);for(l=u;l<=c;l++){for(n=0,h=u;h<=c;h++)n+=r[h]*o.get(h,l);for(n=n/r[u]/e.get(u,u-1),h=u;h<=c;h++)o.set(h,l,o.get(h,l)+n*r[h])}}}(n,t,e,i),function(t,e,r,o,s){let n,i,h,l,u,a,c,f,m,g,w,p,d,y,x,M=t-1,b=t-1,v=Number.EPSILON,E=0,S=0,k=0,R=0,I=0,T=0,q=0,A=0;for(n=0;n<t;n++)for((n<0||n>b)&&(r[n]=s.get(n,n),e[n]=0),i=Math.max(n-1,0);i<t;i++)S+=Math.abs(s.get(n,i));for(;M>=0;){for(l=M;l>0&&(T=Math.abs(s.get(l-1,l-1))+Math.abs(s.get(l,l)),0===T&&(T=S),!(Math.abs(s.get(l,l-1))<v*T));)l--;if(l===M)s.set(M,M,s.get(M,M)+E),r[M]=s.get(M,M),e[M]=0,M--,A=0;else if(l===M-1){if(c=s.get(M,M-1)*s.get(M-1,M),k=(s.get(M-1,M-1)-s.get(M,M))/2,R=k*k+c,q=Math.sqrt(Math.abs(R)),s.set(M,M,s.get(M,M)+E),s.set(M-1,M-1,s.get(M-1,M-1)+E),f=s.get(M,M),R>=0){for(q=k>=0?k+q:k-q,r[M-1]=f+q,r[M]=r[M-1],0!==q&&(r[M]=f-c/q),e[M-1]=0,e[M]=0,f=s.get(M,M-1),T=Math.abs(f)+Math.abs(q),k=f/T,R=q/T,I=Math.sqrt(k*k+R*R),k/=I,R/=I,i=M-1;i<t;i++)q=s.get(M-1,i),s.set(M-1,i,R*q+k*s.get(M,i)),s.set(M,i,R*s.get(M,i)-k*q);for(n=0;n<=M;n++)q=s.get(n,M-1),s.set(n,M-1,R*q+k*s.get(n,M)),s.set(n,M,R*s.get(n,M)-k*q);for(n=0;n<=b;n++)q=o.get(n,M-1),o.set(n,M-1,R*q+k*o.get(n,M)),o.set(n,M,R*o.get(n,M)-k*q)}else r[M-1]=f+k,r[M]=f+k,e[M-1]=q,e[M]=-q;M-=2,A=0}else{if(f=s.get(M,M),m=0,c=0,l<M&&(m=s.get(M-1,M-1),c=s.get(M,M-1)*s.get(M-1,M)),10===A){for(E+=f,n=0;n<=M;n++)s.set(n,n,s.get(n,n)-f);T=Math.abs(s.get(M,M-1))+Math.abs(s.get(M-1,M-2)),f=m=.75*T,c=-.4375*T*T}if(30===A&&(T=(m-f)/2,T=T*T+c,T>0)){for(T=Math.sqrt(T),m<f&&(T=-T),T=f-c/((m-f)/2+T),n=0;n<=M;n++)s.set(n,n,s.get(n,n)-T);E+=T,f=m=c=.964}for(A+=1,u=M-2;u>=l&&(q=s.get(u,u),I=f-q,T=m-q,k=(I*T-c)/s.get(u+1,u)+s.get(u,u+1),R=s.get(u+1,u+1)-q-I-T,I=s.get(u+2,u+1),T=Math.abs(k)+Math.abs(R)+Math.abs(I),k/=T,R/=T,I/=T,u!==l)&&!(Math.abs(s.get(u,u-1))*(Math.abs(R)+Math.abs(I))<v*(Math.abs(k)*(Math.abs(s.get(u-1,u-1))+Math.abs(q)+Math.abs(s.get(u+1,u+1)))));)u--;for(n=u+2;n<=M;n++)s.set(n,n-2,0),n>u+2&&s.set(n,n-3,0);for(h=u;h<=M-1&&(y=h!==M-1,h!==u&&(k=s.get(h,h-1),R=s.get(h+1,h-1),I=y?s.get(h+2,h-1):0,f=Math.abs(k)+Math.abs(R)+Math.abs(I),0!==f&&(k/=f,R/=f,I/=f)),0!==f);h++)if(T=Math.sqrt(k*k+R*R+I*I),k<0&&(T=-T),0!==T){for(h!==u?s.set(h,h-1,-T*f):l!==u&&s.set(h,h-1,-s.get(h,h-1)),k+=T,f=k/T,m=R/T,q=I/T,R/=k,I/=k,i=h;i<t;i++)k=s.get(h,i)+R*s.get(h+1,i),y&&(k+=I*s.get(h+2,i),s.set(h+2,i,s.get(h+2,i)-k*q)),s.set(h,i,s.get(h,i)-k*f),s.set(h+1,i,s.get(h+1,i)-k*m);for(n=0;n<=Math.min(M,h+3);n++)k=f*s.get(n,h)+m*s.get(n,h+1),y&&(k+=q*s.get(n,h+2),s.set(n,h+2,s.get(n,h+2)-k*I)),s.set(n,h,s.get(n,h)-k),s.set(n,h+1,s.get(n,h+1)-k*R);for(n=0;n<=b;n++)k=f*o.get(n,h)+m*o.get(n,h+1),y&&(k+=q*o.get(n,h+2),o.set(n,h+2,o.get(n,h+2)-k*I)),o.set(n,h,o.get(n,h)-k),o.set(n,h+1,o.get(n,h+1)-k*R)}}}if(0===S)return;for(M=t-1;M>=0;M--)if(k=r[M],R=e[M],0===R)for(l=M,s.set(M,M,1),n=M-1;n>=0;n--){for(c=s.get(n,n)-k,I=0,i=l;i<=M;i++)I+=s.get(n,i)*s.get(i,M);if(e[n]<0)q=c,T=I;else if(l=n,0===e[n]?s.set(n,M,0!==c?-I/c:-I/(v*S)):(f=s.get(n,n+1),m=s.get(n+1,n),R=(r[n]-k)*(r[n]-k)+e[n]*e[n],a=(f*T-q*I)/R,s.set(n,M,a),s.set(n+1,M,Math.abs(f)>Math.abs(q)?(-I-c*a)/f:(-T-m*a)/q)),a=Math.abs(s.get(n,M)),v*a*a>1)for(i=n;i<=M;i++)s.set(i,M,s.get(i,M)/a)}else if(R<0)for(l=M-1,Math.abs(s.get(M,M-1))>Math.abs(s.get(M-1,M))?(s.set(M-1,M-1,R/s.get(M,M-1)),s.set(M-1,M,-(s.get(M,M)-k)/s.get(M,M-1))):(x=tt(0,-s.get(M-1,M),s.get(M-1,M-1)-k,R),s.set(M-1,M-1,x[0]),s.set(M-1,M,x[1])),s.set(M,M-1,0),s.set(M,M,1),n=M-2;n>=0;n--){for(g=0,w=0,i=l;i<=M;i++)g+=s.get(n,i)*s.get(i,M-1),w+=s.get(n,i)*s.get(i,M);if(c=s.get(n,n)-k,e[n]<0)q=c,I=g,T=w;else if(l=n,0===e[n]?(x=tt(-g,-w,c,R),s.set(n,M-1,x[0]),s.set(n,M,x[1])):(f=s.get(n,n+1),m=s.get(n+1,n),p=(r[n]-k)*(r[n]-k)+e[n]*e[n]-R*R,d=2*(r[n]-k)*R,0===p&&0===d&&(p=v*S*(Math.abs(c)+Math.abs(R)+Math.abs(f)+Math.abs(m)+Math.abs(q))),x=tt(f*I-q*g+R*w,f*T-q*w-R*g,p,d),s.set(n,M-1,x[0]),s.set(n,M,x[1]),Math.abs(f)>Math.abs(q)+Math.abs(R)?(s.set(n+1,M-1,(-g-c*s.get(n,M-1)+R*s.get(n,M))/f),s.set(n+1,M,(-w-c*s.get(n,M)-R*s.get(n,M-1))/f)):(x=tt(-I-m*s.get(n,M-1),-T-m*s.get(n,M),q,R),s.set(n+1,M-1,x[0]),s.set(n+1,M,x[1]))),a=Math.max(Math.abs(s.get(n,M-1)),Math.abs(s.get(n,M))),v*a*a>1)for(i=n;i<=M;i++)s.set(i,M-1,s.get(i,M-1)/a),s.set(i,M,s.get(i,M)/a)}for(n=0;n<t;n++)if(n<0||n>b)for(i=n;i<t;i++)o.set(n,i,s.get(n,i));for(i=t-1;i>=0;i--)for(n=0;n<=b;n++){for(q=0,h=0;h<=Math.min(i,b);h++)q+=o.get(n,h)*s.get(h,i);o.set(n,i,q)}}(n,l,h,i,t)}this.n=n,this.e=l,this.d=h,this.V=i}get realEigenvalues(){return Array.from(this.d)}get imaginaryEigenvalues(){return Array.from(this.e)}get eigenvectorMatrix(){return this.V}get diagonalMatrix(){let t,e,r=this.n,o=this.e,s=this.d,n=new S(r,r);for(t=0;t<r;t++){for(e=0;e<r;e++)n.set(t,e,0);n.set(t,t,s[t]),o[t]>0?n.set(t,t+1,o[t]):o[t]<0&&n.set(t,t-1,o[t])}return n}}function tt(t,e,r,o){let s,n;return Math.abs(r)>Math.abs(o)?(s=o/r,n=r+s*o,[(t+s*e)/n,(e-s*t)/n]):(s=r/o,n=o+s*r,[(s*t+e)/n,(s*e-t)/n])}class et{constructor(t){if(!(t=F.checkMatrix(t)).isSymmetric())throw new Error("Matrix is not symmetric");let e,r,o,s=t,n=s.rows,i=new S(n,n),h=!0;for(r=0;r<n;r++){let t=0;for(o=0;o<r;o++){let n=0;for(e=0;e<o;e++)n+=i.get(o,e)*i.get(r,e);n=(s.get(r,o)-n)/i.get(o,o),i.set(r,o,n),t+=n*n}for(t=s.get(r,r)-t,h&=t>0,i.set(r,r,Math.sqrt(Math.max(t,0))),o=r+1;o<n;o++)i.set(r,o,0)}this.L=i,this.positiveDefinite=Boolean(h)}isPositiveDefinite(){return this.positiveDefinite}solve(t){t=F.checkMatrix(t);let e=this.L,r=e.rows;if(t.rows!==r)throw new Error("Matrix dimensions do not match");if(!1===this.isPositiveDefinite())throw new Error("Matrix is not positive definite");let o,s,n,i=t.columns,h=t.clone();for(n=0;n<r;n++)for(s=0;s<i;s++){for(o=0;o<n;o++)h.set(n,s,h.get(n,s)-h.get(o,s)*e.get(n,o));h.set(n,s,h.get(n,s)/e.get(n,n))}for(n=r-1;n>=0;n--)for(s=0;s<i;s++){for(o=n+1;o<r;o++)h.set(n,s,h.get(n,s)-h.get(o,s)*e.get(o,n));h.set(n,s,h.get(n,s)/e.get(n,n))}return h}get lowerTriangularMatrix(){return this.L}}class rt{constructor(t,e={}){t=F.checkMatrix(t);let{Y:r}=e;const{scaleScores:o=!1,maxIterations:s=1e3,terminationCriteria:n=1e-10}=e;let i;if(r){if(r=Array.isArray(r)&&"number"==typeof r[0]?S.columnVector(r):F.checkMatrix(r),!r.isColumnVector()||r.rows!==t.rows)throw new Error("Y must be a column vector of length X.rows");i=r}else i=t.getColumnVector(0);let h,l,u,a,c=1;for(let e=0;e<s&&c>n;e++)u=t.transpose().mmul(i).div(i.transpose().mmul(i).get(0,0)),u=u.div(u.norm()),h=t.mmul(u).div(u.transpose().mmul(u).get(0,0)),e>0&&(c=h.clone().sub(a).pow(2).sum()),a=h.clone(),r?(l=r.transpose().mmul(h).div(h.transpose().mmul(h).get(0,0)),l=l.div(l.norm()),i=r.mmul(l).div(l.transpose().mmul(l).get(0,0))):i=h;if(r){let e=t.transpose().mmul(h).div(h.transpose().mmul(h).get(0,0));e=e.div(e.norm());let o=t.clone().sub(h.clone().mmul(e.transpose())),s=i.transpose().mmul(h).div(h.transpose().mmul(h).get(0,0)),n=r.clone().sub(h.clone().mulS(s.get(0,0)).mmul(l.transpose()));this.t=h,this.p=e.transpose(),this.w=u.transpose(),this.q=l,this.u=i,this.s=h.transpose().mmul(h),this.xResidual=o,this.yResidual=n,this.betas=s}else this.w=u.transpose(),this.s=h.transpose().mmul(h).sqrt(),this.t=o?h.clone().div(this.s.get(0,0)):h,this.xResidual=t.sub(h.mmul(u.transpose()))}}},function(t,e,r){const{Matcher:o}=r(4),{refineHomography:s}=r(11),{estimateHomography:n}=r(13);let i=null,h=null,l=null;onmessage=t=>{const{data:e}=t;if("setup"===e.type)i=e.projectionTransform,h=e.matchingDataList,l=new o(e.inputWidth,e.inputHeight);else if("match"===e.type){const t=e.skipTargetIndexes;let r=-1,o=null;for(let s=0;s<h.length;s++){if(t.includes(s))continue;const u=l.matchDetection(h[s],e.featurePoints);if(null===u)continue;const{screenCoords:a,worldCoords:c}=u,f=n({screenCoords:a,worldCoords:c,projectionTransform:i});if(null!==f){r=s,o=f;break}}postMessage({type:"matchDone",targetIndex:r,modelViewTransform:o})}else if("track"===e.type){const{modelViewTransform:t,selectedFeatures:r}=e,o=[1,.8,.6,.4,0];let s=null,n=t,h=null;for(let t=0;t<o.length;t++){let e=u({modelViewTransform:n,selectedFeatures:r,projectionTransform:i,inlierProb:o[t]});if(s=e.err,n=e.newModelViewTransform,s<5){h=n;break}}postMessage({type:"trackDone",modelViewTransform:h})}};const u=({modelViewTransform:t,projectionTransform:e,selectedFeatures:r,inlierProb:o})=>{let n=0,i=0,h=0;for(let t=0;t<r.length;t++)n+=r[t].pos3D.x,i+=r[t].pos3D.y,h+=r[t].pos3D.z;n/=r.length,i/=r.length,h/=r.length;const l=[],u=[];for(let t=0;t<r.length;t++)u.push({x:r[t].pos2D.x,y:r[t].pos2D.y}),l.push({x:r[t].pos3D.x-n,y:r[t].pos3D.y-i,z:r[t].pos3D.z-h});const a=[[],[],[]];for(let e=0;e<3;e++)for(let r=0;r<3;r++)a[e][r]=t[e][r];let c;a[0][3]=t[0][0]*n+t[0][1]*i+t[0][2]*h+t[0][3],a[1][3]=t[1][0]*n+t[1][1]*i+t[1][2]*h+t[1][3],a[2][3]=t[2][0]*n+t[2][1]*i+t[2][2]*h+t[2][3],c=s(o<1?{initialModelViewTransform:a,projectionTransform:e,worldCoords:l,screenCoords:u,isRobustMode:!0,inlierProb:o}:{initialModelViewTransform:a,projectionTransform:e,worldCoords:l,screenCoords:u,isRobustMode:!1});const f=[[],[],[]];for(let t=0;t<3;t++)for(let e=0;e<3;e++)f[t][e]=c.modelViewTransform[t][e];return f[0][3]=c.modelViewTransform[0][3]-c.modelViewTransform[0][0]*n-c.modelViewTransform[0][1]*i-c.modelViewTransform[0][2]*h,f[1][3]=c.modelViewTransform[1][3]-c.modelViewTransform[1][0]*n-c.modelViewTransform[1][1]*i-c.modelViewTransform[1][2]*h,f[2][3]=c.modelViewTransform[2][3]-c.modelViewTransform[2][0]*n-c.modelViewTransform[2][1]*i-c.modelViewTransform[2][2]*h,{err:c.err,newModelViewTransform:f}}},function(t,e,r){const{match:o}=r(5);t.exports={Matcher:class{constructor(t,e){this.queryWidth=t,this.queryHeight=e}matchDetection(t,e){const r=o({keyframes:t,querypoints:e,querywidth:this.queryWidth,queryheight:this.queryHeight});if(null===r)return null;const s=[],n=[],i=t[r.keyframeIndex];for(let t=0;t<r.matches.length;t++){const o=r.matches[t].querypointIndex,h=r.matches[t].keypointIndex;s.push({x:e[o].x,y:e[o].y}),n.push({x:(i.points[h].x+.5)/i.scale,y:(i.height-.5-i.points[h].y)/i.scale,z:0})}return{screenCoords:s,worldCoords:n,keyframeIndex:r.keyframeIndex}}}}},function(t,e,r){const o=r(6).default,{compute:s}=r(7),{computeHoughMatches:n}=r(8),{computeHomography:i}=r(9),{multiplyPointHomographyInhomogenous:h,matrixInverse33:l}=r(1),u=({node:t,keypoints:e,querypoint:r,queue:o,keypointIndexes:n,numPop:i})=>{if(t.leaf){for(let e=0;e<t.pointIndexes.length;e++)n.push(t.pointIndexes[e]);return}const h=[];for(let o=0;o<t.children.length;o++){const n=t.children[o].centerPointIndex,i=s({v1:e[n].descriptors,v2:r.descriptors});h.push(i)}let l=Number.MAX_SAFE_INTEGER;for(let e=0;e<t.children.length;e++)l=Math.min(l,h[e]);for(let e=0;e<t.children.length;e++)h[e]!==l&&o.push({node:t.children[e],d:h[e]});for(let s=0;s<t.children.length;s++)h[s]===l&&u({node:t.children[s],keypoints:e,querypoint:r,queue:o,keypointIndexes:n,numPop:i});if(i<8&&o.length>0){const{node:t,d:s}=o.pop();u({node:t,keypoints:e,querypoint:r,queue:o,keypointIndexes:n,numPop:i+=1})}},a=t=>{const{keypoints:e,querypoints:r,H:o,matches:s,threshold:n}=t,i=n*n,l=[];for(let t=0;t<s.length;t++){const n=r[s[t].querypointIndex],u=e[s[t].keypointIndex],a=h([u.x,u.y],o);(a[0]-n.x)*(a[0]-n.x)+(a[1]-n.y)*(a[1]-n.y)<=i&&l.push(s[t])}return l};t.exports={match:({keyframes:t,querypoints:e,querywidth:r,queryheight:c})=>{let f=null;for(let m=0;m<t.length;m++){const g=t[m],w=g.points,p=[];for(let t=0;t<e.length;t++){const r=g.pointsCluster.rootNode,n=e[t],i=[],h=new o([],(t,e)=>t.d-e.d);u({node:r,keypoints:w,querypoint:n,queue:h,keypointIndexes:i,numPop:0});let l=-1,a=Number.MAX_SAFE_INTEGER,c=Number.MAX_SAFE_INTEGER;for(let t=0;t<i.length;t++){const e=w[i[t]];if(e.maxima!=n.maxima)continue;const r=s({v1:e.descriptors,v2:n.descriptors});r<a?(c=a,a=r,l=i[t]):r<c&&(c=r)}-1!==l&&(c===Number.MAX_SAFE_INTEGER||1*a/c<.7)&&p.push({querypointIndex:t,keypointIndex:l})}if(p.length<6)continue;const d=n({keypoints:g.points,querypoints:e,keywidth:g.width,keyheight:g.height,querywidth:r,queryheight:c,matches:p}),y=[],x=[];for(let t=0;t<d.length;t++){const r=e[d[t].querypointIndex],o=w[d[t].keypointIndex];y.push([o.x,o.y]),x.push([r.x,r.y])}const M=i({srcPoints:y,dstPoints:x,keyframe:g});if(null===M)continue;if(a({querypoints:e,keypoints:g.points,H:M,matches:d,threshold:3}).length<6)continue;const b=l(M,1e-5),v=100,E=[];for(let t=0;t<e.length;t++){const r=e[t],o=h([r.x,r.y],b);let n=-1,i=Number.MAX_SAFE_INTEGER,l=Number.MAX_SAFE_INTEGER;for(let t=0;t<w.length;t++){const e=w[t];if(e.maxima!=r.maxima)continue;if((e.x-o[0])*(e.x-o[0])+(e.y-o[1])*(e.y-o[1])>v)continue;const h=s({v1:e.descriptors,v2:r.descriptors});h<i?(l=i,i=h,n=t):h<l&&(l=h)}-1!==n&&(l===Number.MAX_SAFE_INTEGER||1*i/l<.7)&&E.push({querypointIndex:t,keypointIndex:n})}const S=n({keypoints:g.points,querypoints:e,keywidth:g.width,keyheight:g.height,querywidth:r,queryheight:c,matches:E}),k=[],R=[];for(let t=0;t<S.length;t++){const r=e[S[t].querypointIndex],o=w[S[t].keypointIndex];k.push([o.x,o.y]),R.push([r.x,r.y])}const I=i({srcPoints:k,dstPoints:R,keyframe:g});if(null===I)continue;const T=a({querypoints:e,keypoints:g.points,H:I,matches:S,threshold:3});T.length<6||(null===f||f.matches.length<T.length)&&(f={keyframeIndex:m,matches:T,H:I})}return f}}},function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return o}));class o{constructor(t=[],e=s){if(this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(let t=(this.length>>1)-1;t>=0;t--)this._down(t)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:e,compare:r}=this,o=e[t];for(;t>0;){const s=t-1>>1,n=e[s];if(r(o,n)>=0)break;e[t]=n,t=s}e[t]=o}_down(t){const{data:e,compare:r}=this,o=this.length>>1,s=e[t];for(;t<o;){let o=1+(t<<1),n=e[o];const i=o+1;if(i<this.length&&r(e[i],n)<0&&(o=i,n=e[i]),r(n,s)>=0)break;e[t]=n,t=o}e[t]=s}}function s(t,e){return t<e?-1:t>e?1:0}},function(t,e){const r=t=>{var e=t-(t>>1&1431655765);return e=((e=((e=((e=(e>>2&858993459)+(858993459&e))>>4)+e&252645135)>>8)+e&16711935)>>16)+e&65535};t.exports={compute:t=>{const{v1:e,v2:o}=t;let s=0;for(let t=0;t<e.length;t++){let n=(e[t]^o[t])>>>0;s+=r(n)}return s}}},function(t,e){const r=({querypoint:t,keypoint:e,keycenterX:r,keycenterY:o,scaleOneOverLogK:s})=>{let n=t.angle-e.angle;n<=-Math.PI?n+=2*Math.PI:n>Math.PI&&(n-=2*Math.PI);const i=t.scale/e.scale,h=i*Math.cos(n),l=i*Math.sin(n),u=[h,-l,l,h],a=[u[0]*e.x+u[1]*e.y,u[2]*e.x+u[3]*e.y],c=t.x-a[0],f=t.y-a[1];return{x:u[0]*r+u[1]*o+c,y:u[2]*r+u[3]*o+f,angle:n,scale:Math.log(i)*s}};t.exports={computeHoughMatches:t=>{const{keypoints:e,querypoints:o,keywidth:s,keyheight:n,querywidth:i,queryheight:h,matches:l}=t,u=1.2*i,a=-u,c=1.2*h,f=-c,m=1/Math.log(10),g=Math.max(s,n),w=Math.floor(s/2),p=Math.floor(n/2),d=[];for(let t=0;t<l.length;t++){const r=o[l[t].querypointIndex].scale,s=e[l[t].keypointIndex].scale;0==s&&console.log("ERROR divide zero");const n=r/s;d.push(n*g)}d.sort((t,e)=>t-e);const y=.25*d[Math.floor(d.length/2)-(d.length%2==0?1:0)-1],x=Math.max(5,Math.ceil((u-a)/y)),M=Math.max(5,Math.ceil((c-f)/y)),b=x*M,v=12*b,E=[],S=[],k={};for(let t=0;t<l.length;t++){const s=o[l[t].querypointIndex],n=e[l[t].keypointIndex],{x:i,y:h,scale:g,angle:d}=r({querypoint:s,keypoint:n,keycenterX:w,keycenterY:p,scaleOneOverLogK:m});if(i<a||i>=u||h<f||h>=c||d<=-Math.PI||d>Math.PI||g<-1||g>=1){E[t]=!1;continue}let y=x*(i-a)/(u-a),R=M*(h-f)/(c-f),I=12*(d+Math.PI)/(2*Math.PI),T=10*(g- -1)/2;S[t]={binX:y,binY:R,binAngle:I,binScale:T};let q=Math.floor(y-.5),A=Math.floor(R-.5),C=Math.floor(T-.5),V=(Math.floor(I-.5)+12)%12;if(q<0||q+1>=x||A<0||A+1>=M||C<0||C+1>=10)E[t]=!1;else{for(let t=0;t<2;t++){let e=q+t;for(let t=0;t<2;t++){let r=A+t;for(let t=0;t<2;t++){let o=(V+t)%12;for(let t=0;t<2;t++){const s=e+r*x+o*b+(C+t)*v;void 0===k[s]&&(k[s]=0),k[s]+=1}}}}E[t]=!0}}let R=0,I=-1;if(Object.keys(k).forEach(t=>{k[t]>R&&(R=k[t],I=t)}),R<3)return[];const T=Math.floor(I%v%b%x),q=Math.floor((I-T)%v%b/x),A=Math.floor((I-T-q*x)%v/b),C=Math.floor((I-T-q*x-A*b)/v),V=[];for(let t=0;t<l.length;t++){if(!E[t])continue;const e=S[t];if(Math.abs(e.binX-(T+.5))>=1)continue;if(Math.abs(e.binY-(q+.5))>=1)continue;if(Math.abs(e.binScale-(C+.5))>=1)continue;const r=Math.abs(e.binAngle-(A+.5));Math.min(r,12-r)>=1||V.push(l[t])}return V}}},function(t,e,r){const{createRandomizer:o}=r(10),{quadrilateralConvex:s,matrixInverse33:n,smallestTriangleArea:h,multiplyPointHomographyInhomogenous:l,checkThreePointsConsistent:u,checkFourPointsConsistent:a,determinant:c}=r(1),f=({H:t,testPoints:e,keyframe:r})=>{const o=n(t,1e-5);if(null===o)return!1;const i=[];for(let t=0;t<e.length;t++)i.push(l(e[t],o));return!(h(i[0],i[1],i[2],i[3])<r.width*r.height*1e-4)&&!!s(i[0],i[1],i[2],i[3])},m=({inH:t})=>{const e=1/t[8],r=[];for(let o=0;o<8;o++)r[o]=t[o]*e;return r[8]=1,r},g=({H:t,srcPoint:e,dstPoint:r,oneOverScale2:o})=>{const s=l(e,t),n=[s[0]-r[0],s[1]-r[1]];return Math.log(1+(n[0]*n[0]+n[1]*n[1])*o)},w=({H:t,testPoints:e})=>{const r=[];for(let o=0;o<e.length;o++)r[o]=l(e[o],t);for(let t=0;t<e.length;t++){const o=t,s=(t+1)%e.length,n=(t+2)%e.length;if(!u(e[o],e[s],e[n],r[o],r[s],r[n]))return!1}return!0},p=({x1:t,x2:e,x3:r,x4:o})=>{const s=[],n=[],i=[],h=[],l=[];s[0]=(t[0]+e[0]+r[0]+o[0])/4,s[1]=(t[1]+e[1]+r[1]+o[1])/4,n[0]=t[0]-s[0],n[1]=t[1]-s[1],i[0]=e[0]-s[0],i[1]=e[1]-s[1],h[0]=r[0]-s[0],h[1]=r[1]-s[1],l[0]=o[0]-s[0],l[1]=o[1]-s[1];const u=(Math.sqrt(n[0]*n[0]+n[1]*n[1])+Math.sqrt(i[0]*i[0]+i[1]*i[1])+Math.sqrt(h[0]*h[0]+h[1]*h[1])+Math.sqrt(l[0]*l[0]+l[1]*l[1]))/4;if(0==u)return null;const a=1/u*1.4142135623730951,c=[],f=[],m=[],g=[];return c[0]=n[0]*a,c[1]=n[1]*a,f[0]=i[0]*a,f[1]=i[1]*a,m[0]=h[0]*a,m[1]=h[1]*a,g[0]=l[0]*a,g[1]=l[1]*a,{xp1:c,xp2:f,xp3:m,xp4:g,s:a,t:s}},d=({srcPoints:t,dstPoints:e})=>{if("undefined"!=typeof window&&window.DEBUG_MATCH){window.debug.homographyIndex+=1;const r=window.debugMatch.querykeyframes[window.debug.querykeyframeIndex].homography[window.debug.homographyIndex],{x1:o,x2:s,x3:n,x4:i,xp1:h,xp2:l,xp3:u,xp4:a}=r,c=[t[0],t[1],t[2],t[3],e[0],e[1],e[2],e[3]],f=[o,s,n,i,h,l,u,a];for(let t=0;t<c.length;t++)window.cmp(c[t][0],f[t][0])&&window.cmp(c[t][1],f[t][1])||console.log("INCORRECT homography points",window.debug.homographyIndex,t,c[t],f[t])}const r=p({x1:t[0],x2:t[1],x3:t[2],x4:t[3]});if(null===r)return null;if("undefined"!=typeof window&&window.DEBUG_MATCH){const t=window.debugMatch.querykeyframes[window.debug.querykeyframeIndex].homography[window.debug.homographyIndex],{x1p:e,x2p:o,x3p:s,x4p:n,t:i,s:h}=t,l=[r.xp1,r.xp2,r.xp3,r.xp4,r.t],u=[e,o,s,n,i];for(let t=0;t<l.length;t++)window.cmp(l[t][0],u[t][0])&&window.cmp(l[t][1],u[t][1])||console.log("INCORRECT homography res1",window.debug.homographyIndex,t,l[t],u[t]);window.cmp(r.s,h)||console.log("INCORRECT homography res1 S",window.debug.homographyIndex,r.s,h)}const o=p({x1:e[0],x2:e[1],x3:e[2],x4:e[3]});if(null===o)return null;if("undefined"!=typeof window&&window.DEBUG_MATCH){const t=window.debugMatch.querykeyframes[window.debug.querykeyframeIndex].homography[window.debug.homographyIndex],{xp1p:e,xp2p:r,xp3p:s,xp4p:n,tp:h,sp:l}=t,u=[o.xp1,o.xp2,o.xp3,o.xp4,o.t],a=[e,r,s,n,h];for(let t=0;t<u.length;t++)window.cmp(u[t][0],a[t][0])&&window.cmp(u[t][1],a[t][1])||console.log("INCORRECT homography res1",window.debug.homographyIndex,t,u[t],a[t]);window.cmp(o.s,l)||console.log("INCORRECT homography res1 S",window.debug.homographyIndex,i,o.s,l)}const s=x({x1:r.xp1,x2:r.xp2,x3:r.xp3,x4:r.xp4,xp1:o.xp1,xp2:o.xp2,xp3:o.xp3,xp4:o.xp4});if(null===s)return null;if(Math.abs(c(s))<1e-5)return null;if("undefined"!=typeof window&&window.DEBUG_MATCH){const t=window.debugMatch.querykeyframes[window.debug.querykeyframeIndex].homography[window.debug.homographyIndex].Hn;window.cmpArray(s,t,.001)||console.log("INCORRECT Hn",window.debug.querykeyframeIndex,window.debug.homographyIndex,s,t);const e=window.debugMatch.querykeyframes[window.debug.querykeyframeIndex].homography[window.debug.homographyIndex].detH;window.cmp(c(s),e)||console.log("INCORRECT determinant",c(s),e)}return y({H:s,s:r.s,t:r.t,sp:o.s,tp:o.t})},y=({H:t,s:e,t:r,sp:o,tp:s})=>{const n=t[6]*s[0],i=t[7]*s[0],h=n+t[0]/o,l=i+t[1]/o,u=t[6]*s[1],a=t[7]*s[1],c=u+t[3]/o,f=a+t[4]/o,m=e*r[0],g=e*r[1],w=[];return w[0]=e*h,w[1]=e*l,w[2]=t[8]*s[0]+t[2]/o-m*h-g*l,w[3]=e*c,w[4]=e*f,w[5]=t[8]*s[1]+t[5]/o-m*c-g*f,w[6]=t[6]*e,w[7]=t[7]*e,w[8]=t[8]-w[6]*r[0]-w[7]*r[1],w},x=({x1:t,x2:e,x3:r,x4:o,xp1:s,xp2:n,xp3:i,xp4:h})=>{const l=[t,e,r,o],u=[s,n,i,h],a=[];for(let t=0;t<4;t++){const e=18*t,r=l[t],o=u[t];a[e+0]=-r[0],a[e+1]=-r[1],a[e+2]=-1,a[e+3]=0,a[e+4]=0,a[e+5]=0,a[e+6]=o[0]*r[0],a[e+7]=o[0]*r[1],a[e+8]=o[0],a[e+9]=0,a[e+10]=0,a[e+11]=0,a[e+12]=-r[0],a[e+13]=-r[1],a[e+14]=-1,a[e+15]=o[1]*r[0],a[e+16]=o[1]*r[1],a[e+17]=o[1]}if("undefined"!=typeof window&&window.DEBUG_MATCH){const t=window.debugMatch.querykeyframes[window.debug.querykeyframeIndex].homography[window.debug.homographyIndex].A;window.cmpArray(a,t)||console.log("INCORRECT A",window.debug.querykeyframeIndex,window.debug.homographyIndex,a,t)}const c=[];for(let t=0;t<72;t++)c[t]=a[t];for(let t=0;t<8;t++){if(t>0)for(let e=t;e<8;e++){let r=0;for(let o=0;o<9;o++)r+=c[9*(t-1)+o]*a[9*e+o];for(let o=0;o<9;o++)c[9*e+o]-=r*c[9*(t-1)+o]}let e=-1,r=-1;const o=[];for(let s=t;s<8;s++){o[s]=0;for(let t=0;t<9;t++)o[s]+=c[9*s+t]*c[9*s+t];o[s]>e&&(e=o[s],r=s)}if(Math.abs(o[r])<1e-13)return null;if(t!==r)for(let e=0;e<9;e++){let o=a[9*t+e];a[9*t+e]=a[9*r+e],a[9*r+e]=o;let s=c[9*t+e];c[9*t+e]=c[9*r+e],c[9*r+e]=s}for(let e=0;e<9;e++)c[9*t+e]=1*c[9*t+e]/Math.sqrt(o[r])}if("undefined"!=typeof window&&window.DEBUG_MATCH){const t=window.debugMatch.querykeyframes[window.debug.querykeyframeIndex].homography[window.debug.homographyIndex].Q8;window.cmpArray(c,t,.001)||console.log("INCORRECT Q8",window.debug.querykeyframeIndex,window.debug.homographyIndex,c,t)}const f=[],m=[];for(let t=0;t<9;t++){for(let e=0;e<9;e++)m[9*t+e]=c[e]*-c[t];m[9*t+t]=1+m[9*t+t];for(let e=1;e<8;e++)for(let r=0;r<9;r++)m[9*t+r]+=c[9*e+r]*-c[9*e+t];let e=0;for(let r=0;r<9;r++)e+=m[9*t+r]*m[9*t+r];if(Math.abs(e)<1e-13)f[t]=0;else{f[t]=Math.sqrt(e);for(let e=0;e<9;e++)m[9*t+e]=m[9*t+e]/f[t]}}if("undefined"!=typeof window&&window.DEBUG_MATCH){const t=window.debugMatch.querykeyframes[window.debug.querykeyframeIndex].homography[window.debug.homographyIndex].X,e=window.debugMatch.querykeyframes[window.debug.querykeyframeIndex].homography[window.debug.homographyIndex].w;window.cmpArray(m,t,.01)||console.log("INCORRECT X",window.debug.querykeyframeIndex,window.debug.homographyIndex,JSON.parse(JSON.stringify(m)),t),window.cmpArray(f,e,.01)||console.log("INCORRECT w",window.debug.querykeyframeIndex,window.debug.homographyIndex,JSON.parse(JSON.stringify(f)),e)}let g=-1,w=-1;for(let t=0;t<9;t++)f[t]>w&&(g=t,w=f[t]);if(0==w)return null;const p=[];for(let t=0;t<9;t++)p[t]=m[9*g+t];return p};t.exports={computeHomography:t=>{const{srcPoints:e,dstPoints:r,keyframe:s}=t,n=[[0,0],[s.width,0],[s.width,s.height],[0,s.height]];if(e.length<4)return null;const i=Math.min(50,e.length),h=o(),l=[];for(let t=0;t<e.length;t++)l[t]=t;h.arrayShuffle({arr:l,sampleSize:l.length});let u=0;const c=[];for(;u<1064&&c.length<1024;){if(h.arrayShuffle({arr:l,sampleSize:4}),u+=1,!a(e[l[0]],e[l[1]],e[l[2]],e[l[3]],r[l[0]],r[l[1]],r[l[2]],r[l[3]]))continue;const t=d({srcPoints:[e[l[0]],e[l[1]],e[l[2]],e[l[3]]],dstPoints:[r[l[0]],r[l[1]],r[l[2]],r[l[3]]]});null!==t&&(w({H:t,testPoints:n})&&c.push(t))}if(0===c.length)return null;const p=[];for(let t=0;t<c.length;t++)p.push({H:c[t],cost:0});let y=i;for(let t=0;t<e.length&&p.length>2;t+=y){y=Math.min(i,e.length-t);let o=t+y;for(let s=0;s<p.length;s++)for(let n=t;n<o;n++){const t=g({H:p[s].H,srcPoint:e[n],dstPoint:r[n],oneOverScale2:1e4});p[s].cost+=t}p.sort((t,e)=>t.cost-e.cost),p.splice(-Math.floor((p.length+1)/2))}let x=0;for(let t=1;t<p.length;t++)p[t].cost<p[x].cost&&(x=t);const M=m({inH:p[x].H});return f({H:M,testPoints:n,keyframe:s})?M:null}}},function(t,e){t.exports={createRandomizer:()=>({seed:1234,arrayShuffle(t){const{arr:e,sampleSize:r}=t;for(let t=0;t<r;t++){this.seed=(214013*this.seed+2531011)%(1<<31);let r=this.seed>>16&32767;r%=e.length;let o=e[t];e[t]=e[r],e[r]=o}},nextInt(t){this.seed=(214013*this.seed+2531011)%(1<<31);let e=this.seed>>16&32767;return e%=t,e}})}},function(t,e,r){const{Matrix:o,inverse:s}=r(2),{applyModelViewProjectionTransform:n,buildModelViewProjectionTransform:i,computeScreenCoordiate:h}=r(12);_updateModelViewTransform=({modelViewTransform:t,dS:e})=>{const r=[];let o=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];o<1e-6?(r[0]=1,r[1]=0,r[2]=0,r[3]=0):(o=Math.sqrt(o),r[0]=e[0]/o,r[1]=e[1]/o,r[2]=e[2]/o,r[3]=o),r[4]=e[3],r[5]=e[4],r[6]=e[5];const s=Math.cos(r[3]),n=1-s,i=Math.sin(r[3]),h=[[],[],[]];h[0][0]=r[0]*r[0]*n+s,h[0][1]=r[0]*r[1]*n-r[2]*i,h[0][2]=r[0]*r[2]*n+r[1]*i,h[0][3]=r[4],h[1][0]=r[1]*r[0]*n+r[2]*i,h[1][1]=r[1]*r[1]*n+s,h[1][2]=r[1]*r[2]*n-r[0]*i,h[1][3]=r[5],h[2][0]=r[2]*r[0]*n-r[1]*i,h[2][1]=r[2]*r[1]*n+r[0]*i,h[2][2]=r[2]*r[2]*n+s,h[2][3]=r[6];const l=[[],[],[]];for(let e=0;e<3;e++){for(let r=0;r<4;r++)l[e][r]=t[e][0]*h[0][r]+t[e][1]*h[1][r]+t[e][2]*h[2][r];l[e][3]+=t[e][3]}return l},_getDeltaS=({dU:t,J_U_S:e})=>{const r=new o(e),n=new o(t),i=r.transpose(),h=i.mmul(r),l=i.mmul(n);let u;try{u=s(h)}catch(t){return null}return u.mmul(l).to1DArray()},_getJ_U_S=({modelViewProjectionTransform:t,modelViewTransform:e,projectionTransform:r,worldCoord:o})=>{const s=e,{x:i,y:h,z:l}=o,u=n(t,i,h,l),a=u.z*u.z,c=[[],[]];c[0][0]=(r[0][0]*u.z-r[2][0]*u.x)/a,c[0][1]=(r[0][1]*u.z-r[2][1]*u.x)/a,c[0][2]=(r[0][2]*u.z-r[2][2]*u.x)/a,c[1][0]=(r[1][0]*u.z-r[2][0]*u.y)/a,c[1][1]=(r[1][1]*u.z-r[2][1]*u.y)/a,c[1][2]=(r[1][2]*u.z-r[2][2]*u.y)/a;const f=[[s[0][2]*h-s[0][1]*l,s[0][0]*l-s[0][2]*i,s[0][1]*i-s[0][0]*h,s[0][0],s[0][1],s[0][2]],[s[1][2]*h-s[1][1]*l,s[1][0]*l-s[1][2]*i,s[1][1]*i-s[1][0]*h,s[1][0],s[1][1],s[1][2]],[s[2][2]*h-s[2][1]*l,s[2][0]*l-s[2][2]*i,s[2][1]*i-s[2][0]*h,s[2][0],s[2][1],s[2][2]]],m=[[],[]];for(let t=0;t<2;t++)for(let e=0;e<6;e++){m[t][e]=0;for(let r=0;r<3;r++)m[t][e]+=c[t][r]*f[r][e]}return m},t.exports={refineHomography:({initialModelViewTransform:t,projectionTransform:e,worldCoords:r,screenCoords:o,isRobustMode:s,inlierProb:n})=>{let l=t,u=0,a=0;for(let t=0;t<=10;t++){const c=i(e,l),f=[],m=[],g=[];for(let t=0;t<r.length;t++){const e=h(c,r[t].x,r[t].y,r[t].z),s=o[t].x-e.x,n=o[t].y-e.y;m.push(s),g.push(n),f.push(s*s+n*n)}let w;if(a=0,s){const t=Math.max(3,Math.floor(r.length*n)-1),e=[];for(let t=0;t<r.length;t++)e.push(f[t]);e.sort((t,e)=>t-e),w=Math.max(4*e[t],16);for(let t=0;t<r.length;t++)e[t]>w?a+=w/6:a+=w/6*(1-(1-e[t]/w)*(1-e[t]/w)*(1-e[t]/w))}else for(let t=0;t<r.length;t++)a+=f[t];if(a/=r.length,a<.1)break;if(t>0&&a<4&&a/u>.99)break;if(10===t)break;u=a;const p=[],d=[];for(let t=0;t<r.length;t++){if(s&&f[t]>w)continue;const o=_getJ_U_S({modelViewProjectionTransform:c,modelViewTransform:l,projectionTransform:e,worldCoord:r[t]});if(s){const e=(1-f[t]/w)*(1-f[t]/w);for(let t=0;t<2;t++)for(let r=0;r<6;r++)o[t][r]*=e;p.push([m[t]*e]),p.push([g[t]*e])}else p.push([m[t]]),p.push([g[t]]);for(let t=0;t<o.length;t++)d.push(o[t])}const y=_getDeltaS({dU:p,J_U_S:d});if(null===y)break;l=_updateModelViewTransform({modelViewTransform:l,dS:y})}return{modelViewTransform:l,err:a}}}},function(t,e){const r=(t,e,r,o)=>({x:t[0][0]*e+t[0][1]*r+t[0][2]*o+t[0][3],y:t[1][0]*e+t[1][1]*r+t[1][2]*o+t[1][3],z:t[2][0]*e+t[2][1]*r+t[2][2]*o+t[2][3]});t.exports={screenToMarkerCoordinate:(t,e,r)=>{const o=t[2][0]*e-t[0][0],s=t[2][1]*e-t[0][1],n=t[2][0]*r-t[1][0],i=t[2][1]*r-t[1][1],h=t[0][3]-t[2][3]*e,l=t[1][3]-t[2][3]*r,u=o*i-s*n;return{x:(i*h-s*l)/u,y:(o*l-n*h)/u}},buildModelViewProjectionTransform:(t,e)=>{const r=[[],[],[]];for(let o=0;o<3;o++)for(let s=0;s<4;s++)r[o][s]=t[o][0]*e[0][s]+t[o][1]*e[1][s]+t[o][2]*e[2][s];return r},applyModelViewProjectionTransform:r,computeScreenCoordiate:(t,e,o,s)=>{const{x:n,y:i,z:h}=r(t,e,o,s);return Math.abs(h)<1e-6?null:{x:n/h,y:i/h}}}},function(t,e,r){const{Matrix:o,inverse:s}=r(2);t.exports={estimateHomography:({screenCoords:t,worldCoords:e,projectionTransform:r})=>{const n=t.length,i=[],h=[];for(let r=0;r<n;r++){const o=[e[r].x,e[r].y,1,0,0,0,-e[r].x*t[r].x,-e[r].y*t[r].x],s=[0,0,0,e[r].x,e[r].y,1,-e[r].x*t[r].y,-e[r].y*t[r].y];i.push(o),i.push(s),h.push([t[r].x]),h.push([t[r].y])}const l=new o(i),u=new o(h),a=l.transpose(),c=a.mmul(l),f=a.mmul(u),m=s(c).mmul(f).to1DArray(),g=new o([[m[0],m[1],m[2]],[m[3],m[4],m[5]],[m[6],m[7],1]]),w=new o(r),p=s(w).mmul(g).to1DArray(),d=Math.sqrt(p[0]*p[0]+p[3]*p[3]+p[6]*p[6]),y=Math.sqrt(p[1]*p[1]+p[4]*p[4]+p[7]*p[7]),x=(d+y)/2,M=[];M[0]=p[0]/d,M[3]=p[3]/d,M[6]=p[6]/d,M[1]=p[1]/y,M[4]=p[4]/y,M[7]=p[7]/y,M[2]=M[3]*M[7]-M[6]*M[4],M[5]=M[6]*M[1]-M[0]*M[7],M[8]=M[0]*M[4]-M[1]*M[3];const b=Math.sqrt(M[2]*M[2]+M[5]*M[5]+M[8]*M[8]);M[2]/=b,M[5]/=b,M[8]/=b;const v=[];return v[0]=p[2]/x,v[1]=p[5]/x,v[2]=p[8]/x,[[M[0],M[1],M[2],v[0]],[M[3],M[4],M[5],v[1]],[M[6],M[7],M[8],v[2]]]}}}]);